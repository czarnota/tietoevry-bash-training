<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>presentation</title>
    <style>
    * { box-sizing: border-box; }
    .level2, h1 { max-height: 92vh; margin: 1em auto; background: #fff;
              padding: 0; font-size: 12px; aspect-ratio: 16 / 9; padding: 1.5em 1.5em 1.5em 1.5em;
              display: flex; flex-direction: column; overflow: hidden; flex: 1 1 auto;
              box-shadow: 0 0 0.5em #ddd; color: #333; }
    h1 { align-items: center; flex-direction: row; padding: 0.75em; }
    body { margin: 0; padding: 0; font-family: sans-serif; background: rgb(237, 237, 240); }
    h2 { font-size: 2em; color: #005; }
    img { display: block; margin: auto; width: 100%; height: 100%; overflow: hidden; object-fit: contain;}
    section > p, section > ul { margin: 0 0 0.8em 0; line-height: 1.5em;}
    ul { padding-left: 1em; }
    h2 { margin: 0 0 0.4em 0; }

.language-console .gp { color: #6ec071; }

/*

    Name:       Base16 Tomorrow Dark
    Author:     Chris Kempson (http://chriskempson.com)

    Pygments template by Jan T. Sott (https://github.com/idleberg)
    Created with Base16 Builder by Chris Kempson (https://github.com/chriskempson/base16-builder)

*/
.sourceCode .hll { background-color: #373b41; }

.sourceCode { background: #1d1f21; color: #ffffff; }

.sourceCode .co { color: #969896; } /* Comment */
.sourceCode .err { color: #cc6666; }

/* Error */
.sourceCode .kw { color: #b294bb; } /* Keyword */
.sourceCode .cf { color: #b294bb; } /* Keyword */
.sourceCode .l { color: #de935f; }

/* Literal */
.sourceCode .n { color: #ffffff; }

/* Name */
.sourceCode .ot { color: #8abeb7; } /* Operator */
.sourceCode .op { color: #8abeb7; } /* Operator */
.sourceCode .p { color: #ffffff; }

/* Punctuation */
.sourceCode .cm { color: #969896; }

/* Comment.Multiline */
.sourceCode .pp { color: #69AE69; } /* Comment.Preproc */
.sourceCode .im { color: #69AE69; } /* Comment.Preproc */
.sourceCode .c1 { color: #969896; }

/* Comment.Single */
.sourceCode .cs { color: #969896; }

/* Comment.Special */
.sourceCode .gd { color: #cc6666; }

/* Generic.Deleted */
.sourceCode .ge { font-style: italic; }

/* Generic.Emph */
.sourceCode .gh { color: #ffffff; font-weight: bold; }

/* Generic.Heading */
.sourceCode .gi { color: #b5bd68; }

/* Generic.Inserted */
.sourceCode .gp { color: #969896; font-weight: bold; }

/* Generic.Prompt */
.sourceCode .gs { font-weight: bold; } 
/* Generic.Strong */
.sourceCode .gu { color: #8abeb7; font-weight: bold; }

/* Generic.Subheading */
.sourceCode .kc { color: #b294bb; }

/* Keyword.Constant */
.sourceCode .kd { color: #b294bb; }

/* Keyword.Declaration */
.sourceCode .kn { color: #8abeb7; }

/* Keyword.Namespace */
.sourceCode .kp { color: #b294bb; }

/* Keyword.Pseudo */
.sourceCode .kr { color: #b294bb; }

/* Keyword.Reserved */
.sourceCode .dt { color: #f0c674; } /* Keyword.Type */
.sourceCode .ld { color: #b5bd68; }

/* Literal.Date */
.sourceCode .m { color: #de935f; }

/* Literal.Number */
.sourceCode .s { color: #b5bd68; }

/* Literal.String */
.sourceCode .na { color: #81a2be; }

/* Name.Attribute */
.sourceCode .bu { color: #ffffff; } /* Name.Builtin */
.sourceCode .nc { color: #f0c674; }

/* Name.Class */
.sourceCode .no { color: #cc6666; }

/* Name.Constant */
.sourceCode .nd { color: #8abeb7; }

/* Name.Decorator */
.sourceCode .ni { color: #ffffff; }

/* Name.Entity */
.sourceCode .ne { color: #cc6666; }

/* Name.Exception */
.sourceCode .fu { color: #81a2be; } /* Name.Function */

/* Name.Label */
.sourceCode .nn { color: #f0c674; }

/* Name.Namespace */
.sourceCode .nx { color: #81a2be; }

/* Name.Other */
.sourceCode .py { color: #ffffff; }

/* Name.Property */
.sourceCode .nt { color: #8abeb7; }

/* Name.Tag */
.sourceCode .va { color: #cc6666; } /* Name.Variable */
.sourceCode .ow { color: #8abeb7; }

/* Operator.Word */
.sourceCode .w { color: #ffffff; }

/* Text.Whitespace */
.sourceCode .mf { color: #de935f; }

/* Literal.Number.Float */
.sourceCode .mh { color: #de935f; }

/* Literal.Number.Hex */
.sourceCode .dv { color: #de935f; }

/* Literal.Number.Integer */
.sourceCode .mo { color: #de935f; }

/* Literal.Number.Oct */
.sourceCode .sb { color: #b5bd68; }

/* Literal.String.Backtick */
.sourceCode .sc { color: #ffffff; }

/* Literal.String.Char */
.sourceCode .sd { color: #969896; }

/* x Literal.String.Doc */
.sourceCode .st { color: #b5bd68; }

/* Literal.String.Double */
.sourceCode .sc { color: #de935f; } 
/* Literal.String.Escape */
.sourceCode .sh { color: #b5bd68; }

/* Literal.String.Heredoc */
.sourceCode .si { color: #de935f; }

/* Literal.String.Interpol */
.sourceCode .sx { color: #b5bd68; }

/* Literal.String.Other */
.sourceCode .sr { color: #b5bd68; }

/* Literal.String.Regex */
.sourceCode .s1 { color: #b5bd68; }

/* Literal.String.Single */
.sourceCode .ss { color: #b5bd68; }

/* Literal.String.Symbol */
.sourceCode .bp { color: #ffffff; }

/* Name.Builtin.Pseudo */
.sourceCode .vc { color: #cc6666; }

/* Name.Variable.Class */
.sourceCode .vg { color: #cc6666; }

/* Name.Variable.Global */
.sourceCode .vi { color: #cc6666; }

/* Name.Variable.Instance */
.sourceCode .il { color: #de935f; }

/* Literal.Number.Integer.Long */

div.sourceCode { vertical-align: top; margin: 0 0 0.8em 0; }

pre {
  font-family: monospace;
  font-size: 0.8em;
  margin: 0 0 0.8em 0;
}

.sourceCode a { color: #fff }

.sourceCode pre {
    padding: 0;
    margin: 0;
}

pre code {
  display: block;
  padding: 1em 1.25em;
  overflow-x: auto;
  background: #1d1f21;
  color: #ffffff;
}
      .sourceCode pre code::-webkit-scrollbar {
        -webkit-appearance: none; }
      .sourceCode pre code::-webkit-scrollbar:vertical {
        width: 10px; }
      .sourceCode pre code::-webkit-scrollbar:horizontal {
        height: 10px; }
      .sourceCode pre code::-webkit-scrollbar-thumb {
        background-color: #555; }
      .sourceCode pre code::-webkit-scrollbar-track {
        background-color: #333; }
  .sourceCode::selection {
    background: #fff;
    /* WebKit/Blink Browsers */
    color: #000; }
  .sourceCode::-moz-selection {
    background: #fff;
    /* Gecko Browsers */
    color: #000; }

p > code, li > code {
  background: #fff;
  padding: 0.1em 0.2em;
  box-shadow: 0 2px 4px 0 #ddd;
  border: 1px solid #ddd; }

    </style>
    <link rel="stylesheet" href="assets/styles.css" />
  </head>
  <body>
<section id="bash-training" class="level1">
<h1>Bash training</h1>
<section id="bash" class="level2">
<h2>Bash</h2>
<p>Bash is an Unix shell and command language written for the GNU Project</p>
<p><img src="assets/bash.png" /></p>
</section>
<section id="system-shell" class="level2">
<h2>System shell</h2>
<p><strong>System shell</strong> is a computer program, which acts as an interface between operating system, applications and the user. Using the shell, user can interact with the operating system e.g. <strong>run processes</strong>, perform operations on files, change system settings etc.</p>
<p><img src="assets/0.svg" /></p>
</section>
<section id="examples-of-system-shells---windows-file-explorer" class="level2">
<h2>Examples of system shells - Windows File Explorer</h2>
<p>File Explorer is an application, which allows user to open files and run processes. It is an example of a graphical system shell.</p>
<p><img src="assets/fileexplorer.jpg" /></p>
</section>
<section id="examples-of-system-shells---xbox-series-x-dashboard" class="level2">
<h2>Examples of system shells - Xbox Series X dashboard</h2>
<p>The purpose of Xbox dashboard is to run processes (games), therefore it can also be considered as an example of graphical system shell.</p>
<p><img src="assets/xoneshell.jpg" /></p>
</section>
<section id="examples-of-system-shells---bash" class="level2">
<h2>Examples of system shells - Bash</h2>
<p>Bash is an example of a command-line shell. Other example of command line shells include i. a.: <code>zsh</code>, <code>tcsh</code>, <code>busybox ash</code> and <code>fish</code> shell</p>
<p><img src="assets/bashshell.png" /></p>
</section>
<section id="question-why-do-we-still-use-a-command-line-interface" class="level2">
<h2>Question: Why do we still use a command-line interface?</h2>
<p>Why in the era of graphical user interfaces and amazing user experiences programmers still work using the “ancient” command line interface?</p>
<ul class="incremental">
<li>Do they want to show off?</li>
<li>Are they nerds?</li>
<li>Are they insane people?</li>
</ul>
</section>
<section id="answer-why-do-we-still-use-a-command-line-interface" class="level2">
<h2>Answer: Why do we still use a command-line interface?</h2>
<ul class="incremental">
<li><strong>It is easier to show what you did to others</strong>. You can send a list of commands to the other person instead of screenshots.</li>
<li><strong>It is natural to automate</strong>. What you type can be placed in a text file and you can run it again.</li>
<li><strong>It is faster to write command line applications</strong>. Compare <code>echo hello world</code> with a “Hello World application” in any GUI framework.</li>
</ul>
</section>
<section id="running-programs" class="level2">
<h2>Running programs</h2>
<p>Using Bash system shell we can run processes by typing program names.</p>
<pre class="console"><code>$ PROGRAM_NAME ARGUMENTS...</code></pre>
<p>For example if we want to run a <code>ls</code> program, we can type:</p>
<pre><code>$ ls -l -a /home</code></pre>
</section>
<section id="example-programs---filesystem-operations" class="level2">
<h2>Example programs - filesystem operations</h2>
<p>Examples of programs that manage files and directories</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">cat</span> p0             # print p0 to standard output</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">cat</span> p0 p1 p2       # print p0, p1 and p2 to standard output</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">rm</span> x               # remove file</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">rm</span> -fr a           # remove file or directory <span class="st">&quot;recursively&quot;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">ls</span> d0              # print a list of files in <span class="st">&#39;d0&#39;</span> directory</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">ls</span> -a d0           # print a list of files in <span class="st">&#39;d0&#39;</span> directory including hidden files</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">ls</span> -l d0           # print a more detailed list of files in <span class="st">&#39;d0&#39;</span> directory</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">mv</span> a b             # rename file from <span class="st">&#39;a&#39;</span> to <span class="st">&#39;b&#39;</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">cp</span> a b             # copy <span class="st">&#39;a&#39;</span> file to <span class="st">&#39;b&#39;</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">cp</span> -r a b          # copy <span class="st">&#39;a&#39;</span> directory to <span class="st">&#39;b&#39;</span> recursively</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">cp</span> a b c d         # copy <span class="st">&#39;a&#39;</span>, <span class="st">&#39;b&#39;</span>, <span class="st">&#39;c&#39;</span> into <span class="st">&#39;d&#39;</span> directory</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">touch</span> x            # change <span class="st">&#39;x&#39;</span> file timestamps</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">touch</span> -c x         # change <span class="st">&#39;x&#39;</span> file timestamps, but do not create a file</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">mkdir</span> a            # create directory name <span class="st">&#39;a&#39;</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">mkdir</span> -p a/b/c     # create <span class="st">&#39;a/b/c&#39;</span> directory hierarchy</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">rmdir</span> a            # remove empty directory</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">ln</span> a b             # create hard link named <span class="st">&#39;b&#39;</span> to <span class="st">&#39;a&#39;</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">ln</span> -s a b          # create soft link named <span class="st">&#39;b&#39;</span> to <span class="st">&#39;a&#39;</span></span></code></pre></div>
</section>
<section id="example-programs---access-control" class="level2">
<h2>Example programs - access control</h2>
<p>Examples of programs that manage file and directory permissions</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">chmod</span> 777 f        # change <span class="st">&#39;f&#39;</span> permissions to 777</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">chmod</span> u+x,g+x,o+x  # add execute permission to user, group and others</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">chown</span> user a       # change owner of <span class="st">&#39;a&#39;</span> to <span class="st">&#39;user&#39;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">chown</span> group:user a <span class="co"># change group to &#39;gruop&#39; and owner of &#39;a&#39; to &#39;user&#39;</span></span></code></pre></div>
</section>
<section id="example-programs---archive-management" class="level2">
<h2>Example programs - archive management</h2>
<p>Examples of programs that manage archives</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">tar</span> -tf archive.tar.gz             # print (t) <span class="ex">files</span> in archive (f)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">tar</span> -xzvf archive.tar.gz           # extract (x) <span class="ex">.gz</span> (z) <span class="ex">archive</span>, verbosely (v)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">tar</span> -xjvf archive.tar.bz2 -C dir   # extract (x) <span class="ex">.bz2</span> (j) <span class="ex">archive</span>, verbosely (v) <span class="ex">to</span> <span class="st">&#39;dir&#39;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">tar</span> -cf archive.tar f1 f2 d0       # create (c) <span class="fu">tar</span> archive with files (f) <span class="ex">f1</span> f2 d0</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">tar</span> -cjvpf archive.tar.bz2 f1 f2   # create bz2 (j) <span class="ex">verbosely</span> (v), <span class="ex">preserving</span> permissions (p)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">zip</span> x.zip f0                       # create <span class="st">&#39;x.zip&#39;</span> archive containing <span class="st">&#39;f0&#39;</span> file</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">zip</span> -r x.zip d0                    # create <span class="st">&#39;x.zip&#39;</span> archive containing <span class="st">&#39;d0&#39;</span> directory</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">unzip</span> x.zip                        # unzip <span class="st">&#39;x.zip&#39;</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">unzip</span> -l x.zip                     # print files in <span class="st">&#39;x.zip&#39;</span> archive</span></code></pre></div>
</section>
<section id="question-what-is-the-difference-between-a-symbolic-link-and-a-hard-link" class="level2">
<h2>Question: What is the difference between a symbolic link and a hard link?</h2>
<p>We can create symbolic links using <code>ln</code> program:</p>
<pre class="console"><code>$ ln target destination</code></pre>
<p>We can create hard links using <code>ln</code> program:</p>
<pre class="console"><code>$ ln -s target destination</code></pre>
<p>What is the difference?</p>
</section>
<section id="answer-what-is-the-difference-between-a-symbolic-link-and-a-hard-link" class="level2">
<h2>Answer: What is the difference between a symbolic link and a hard link?</h2>
<pre><code>$ ln bar foo</code></pre>
<pre><code>$ ln -s bar baz</code></pre>
<p><img src="assets/1.svg" /></p>
</section>
<section id="task-the-land-of-tietoevry" class="level2">
<h2>Task: The Land of TietoEvry</h2>
<p>Download the following archive using <code>wget</code> program:</p>
<pre><code>$ wget czarnota.github.io/bashtraining/task-land.tar.gz</code></pre>
<ol class="incremental" type="1">
<li>Extract the archive</li>
<li>Complete all listed missions</li>
<li>Create a <code>.tar.gz</code> archive from the directory</li>
</ol>
</section>
</section>
<section id="options-and-arguments" class="level1">
<h1>Options and arguments</h1>
<section id="options-and-arguments-1" class="level2">
<h2>Options and arguments</h2>
<p>All characters (with the exception of a few built-in bash constructs/operators) following the program’s name are interpreted by the program and can influence its behavior.</p>
<pre class="console"><code>$ PROGRAM_NAME ARGUMENTS...</code></pre>
<pre class="console"><code>$ chmod o+w,g+w file</code></pre>
<pre class="console"><code>$ find . \( -name words -or -name x \) -and -not -executable</code></pre>
<pre class="console"><code>$ tcpdump -i eth0 ip or arp</code></pre>
</section>
<section id="posix-syntax" class="level2">
<h2>POSIX Syntax</h2>
<p>Programs can parse options and arguments as they like, but there exists a common convention that most unix programs follow. This convention is standarised by POSIX.</p>
<p>In below example <code>-a</code> is an option, <code>-b barg</code> is an option with an argument <code>barg</code> and <code>arg0</code> and <code>arg1</code> are just arguments.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>$ <span class="ex">prog</span> -a -b barg arg0 arg1 # The <span class="st">&#39;barg&#39;</span> is an argument to -b option</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>$ <span class="ex">prog</span> -ab barg arg0 arg1   # You can <span class="st">&quot;glue&quot;</span> options together</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>$ <span class="ex">prog</span> -a -- -b barg arg1   # You can terminate options using --, here -b is an argument</span></code></pre></div>
<p>For example, the below two commands are equivalent:</p>
<pre class="console"><code>$ tar -x -z -v -f arch.tar.gz 
$ tar -xzvfarch.tar.gz</code></pre>
</section>
<section id="extended-gnu-syntax" class="level2">
<h2>Extended GNU Syntax</h2>
<p>GNU introduced long options (supported using <code>getopt_long()</code> and <code>getopt_long_only()</code> C library functions)</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>$ <span class="ex">prog</span> -ab --option --key=value arg0 arg1 arg2   # getopt_long()</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>$ <span class="ex">prog</span> -option -key arg0 arg1 arg2               # getopt_long_only()</span></code></pre></div>
<p>Examples of long options</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">ps</span> --user             # getopt_long()</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">ls</span> --all              # getopt_long()</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">find</span> . -name x        # getopt_long_only()</span></code></pre></div>
</section>
<section id="legacy-bsd-syntax" class="level2">
<h2>Legacy BSD Syntax</h2>
<p>Something that <code>ps</code> manual page calls a <code>BSD Syntax</code>. It is supported only by a few programs</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>$ <span class="ex">prog</span> ab arg0 arg1 arg2     # options are: <span class="st">&#39;a&#39;</span> and <span class="st">&#39;b&#39;</span>, the rest are arguments</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>$ <span class="ex">prog</span> abcdef arg0 arg1 arg2 # options are: <span class="st">&#39;a&#39;</span>, <span class="st">&#39;b&#39;</span>, <span class="st">&#39;c&#39;</span>, the rest are arguments</span></code></pre></div>
<p>Examples</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">ps</span> aux</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">tar</span> xzvf arch.tar.gz</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">tar</span> czf files.tar.gz file1 file2</span></code></pre></div>
</section>
<section id="command-syntax---conclusion" class="level2">
<h2>Command syntax - conclusion</h2>
<p>It is important to note that the options and arguments are interpreted by the executed program and not by the shell. For example, if we execute <code>ls</code></p>
<pre><code>$ ls -l -a /home</code></pre>
<p>Then the <code>ls</code> program would receive the following arguments in its <code>main()</code> function.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main(<span class="dt">int</span> argc, <span class="dt">char</span> **argv)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// argv = { &quot;ls&quot;, &quot;-l&quot;, &quot;-a&quot;, &quot;/home&quot; }</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// argc = 4</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Bash only splits the input line into tokens</strong></p>
</section>
<section id="question-which-is-correct" class="level2">
<h2>Question: Which is correct?</h2>
<p>Which commands would you use to create directory called <code>-f</code>, list its contents and then remove it afterwards?</p>
<p>These commands:</p>
<pre class="console"><code>$ mkdir -f
$ ls -f
$ rm -fr -f</code></pre>
<p>Or these:</p>
<pre class="console"><code>$ mkdir &quot;-f&quot;
$ ls &quot;-f&quot;
$ rm -fr &quot;-f&quot;</code></pre>
</section>
<section id="answer-which-is-correct" class="level2">
<h2>Answer: Which is correct?</h2>
<p>Neither. The quotes <code>""</code> make no difference to the executed program. It will still see <code>-f</code> in its argument list. We need to use <code>--</code> to terminate the list of options.</p>
<pre class="console"><code>$ mkdir -- &quot;-f&quot;
$ ls -- &quot;-f&quot;
$ rm -fr -- &quot;-f&quot;</code></pre>
</section>
<section id="example-programs---find" class="level2">
<h2>Example programs - find</h2>
<p>The <code>find</code> program searches for files or directories. For example to find all files named <code>lib_functions.c</code> starting our search from the current working directory <code>.</code>, we can do:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">find</span> . -name <span class="st">&quot;lib_functions.c&quot;</span></span></code></pre></div>
<p>We can search in a case insensitive mode, also using wildcard patterns. The below example will print all files that start with string <code>host</code> (case insensitive). Also it will not print any directories <code>-type f</code></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">find</span> / -iname <span class="st">&quot;host*&quot;</span> -type f</span></code></pre></div>
<p>We can execute a program on each file with <code>.tmp</code> extension. The below command will remove all <code>.tmp</code> files, but will prompt for confirmation before removal (<code>rm -i</code>).</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">find</span> . -name <span class="st">&quot;*.tmp&quot;</span> -exec rm -i {} <span class="dt">\;</span></span></code></pre></div>
</section>
<section id="task-svg-to-png-converter" class="level2">
<h2>Task: SVG to PNG converter</h2>
<p>Download and extract, using the terminal.</p>
<pre><code>https://github.com/simple-icons/archive/develop.zip</code></pre>
<ol class="incremental" type="1">
<li>Convert all <code>.svg</code> icons starting <strong>with the same letter as your surname</strong> into <code>.png</code> files.</li>
<li>Pack converted files into a <code>.zip</code> archive</li>
</ol>
<p>Hints:</p>
<ul class="incremental">
<li><code>find</code> - will allow you to execute a program on selected files;</li>
<li><code>inkscape</code> - will allow you to convert <code>.svg</code> to <code>.png</code>;</li>
<li><code>zip</code> - will allow you to create a <code>.zip</code> archive.</li>
</ul>
</section>
</section>
<section id="processes" class="level1">
<h1>Processes</h1>
<section id="the-difference-between-a-program-and-a-process" class="level2">
<h2>The difference between a program and a process</h2>
<p>A process is a program that is being executed</p>
<p>Program is a list of instructions to be executed (just like a cooking recipe) and a process is an act of executing these instructions (just like cooking). <img src="assets/programandprocess.png" /></p>
</section>
<section id="what-is-a-proces" class="level2">
<h2>What is a proces</h2>
<p>A process is a program that is being executed. It consists of:</p>
<ul class="incremental">
<li><strong>Processor state (registers)</strong> For <code>x86_64</code> these are i. a:
<ul class="incremental">
<li><code>rbp</code> - base of the stack (frame pointer)</li>
<li><code>rsp</code> - stack pointer</li>
<li><code>rip</code> - program counter</li>
<li><code>rflags</code> - flags register</li>
<li>general purpose registers: <code>rax</code>, <code>rcx</code>, <code>rdx</code>, <code>rbx</code>, <code>rsi</code>, <code>rdi</code>, <code>r8</code>-<code>r15</code></li>
</ul></li>
<li><strong>Virtual memory</strong> (Page table) (pointer by <code>CR3</code> register)</li>
<li><strong>Open file descriptors</strong>, for example:
<ul class="incremental">
<li>regular files (opened by <code>open()</code>)</li>
<li>network sockets (opened by <code>socket()</code>, <code>accept()</code>)</li>
<li>pipes (opened by <code>pipe()</code>)</li>
</ul></li>
<li>Other data structure important for Linux kernel</li>
</ul>
</section>
<section id="how-linux-represents-processes" class="level2">
<h2>How Linux represents processes?</h2>
<p>In Linux kernel every process is represented by a <code>struct task_struct</code></p>
<p>Below are some fields in this structure:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> task_struct {</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> list_head tasks           <span class="co">/* An entry on a process list */</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    pid_t pid;                       <span class="co">/* Process identifies (PID)  */</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> mm_struct *mm             <span class="co">/* Process memory */</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> task_struct *real_parent; <span class="co">/* The real parent - the one who called clone() */</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> task_struct *parent;      <span class="co">/* Receiver of SIGCHLD i wait4() */</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> list_head children;       <span class="co">/* Process&#39; children */</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> sigpending pending;       <span class="co">/* List of pending signals */</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> files_struct *files;      <span class="co">/* Open file descriptors */</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> *stack                      <span class="co">/* Pointer to kernel stack of the process </span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co">                                        - on x86_64 the state of registers is</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="co">                                          stored here */</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>};</span></code></pre></div>
</section>
<section id="process-list" class="level2">
<h2>Process list</h2>
<p>Linux internally keeps a circular list of all processes running in the system.</p>
<p><img src="assets/12.svg" /></p>
</section>
<section id="how-can-we-check-which-processes-are-running-at-the-moment" class="level2">
<h2>How can we check which processes are running at the moment</h2>
<p>The <code>ps</code> program can show us all processes, the <code>top</code> program display processes interactively, the <code>pstree</code> prints a tree of processes and the pseudo file system <code>/proc</code> contains entries representing every process.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">ps</span> aux</span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>$ <span class="ex">top</span></span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">pstree</span></span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">ls</span> /proc</span></code></pre></div>
</section>
<section id="running-processes-in-bash---how-does-it-work" class="level2">
<h2>Running processes in Bash - how does it work</h2>
<p>A primitive system shell could be implemented like this:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (true) {</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> *line = readline(<span class="st">&quot;$ &quot;</span>);</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> *my_argv[<span class="dv">12</span>] = {<span class="dv">0</span>};</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (!parse_line(line, my_argv, ARRAY_SIZE(my_argv) - <span class="dv">1</span>))</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">goto</span> out;</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> pid = fork();</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (pid == <span class="dv">0</span>)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>        execvp(my_argv[<span class="dv">0</span>], my_argv);</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> status;</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    waitpid(pid, &amp;status, <span class="dv">0</span>);</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>    report(status);</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>out:</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>    free(line);</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</section>
<section id="running-processes-in-background" class="level2">
<h2>Running processes in background</h2>
<p>In <code>ls &amp;</code> command, the <code>&amp;</code> will run the process in the background. It omits the call to <code>waitpid()</code>.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (true) {</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> *line = readline(<span class="st">&quot;$ &quot;</span>);</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> *my_argv[<span class="dv">12</span>] = {<span class="dv">0</span>};</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (!parse_line(line, my_argv, ARRAY_SIZE(my_argv) - <span class="dv">1</span>))</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">goto</span> out;</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> pid = fork();</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (pid == <span class="dv">0</span>)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>        execvp(my_argv[<span class="dv">0</span>], my_argv);</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> status;</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (in_background(line))</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>        status = <span class="dv">0</span>;</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>        waitpid(pid, &amp;status, <span class="dv">0</span>);</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>    report(status);</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>out:</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>    free(line);</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</section>
<section id="question-if-we-omit-waitpid-and-bash-is-still-running-why-there-are-no-zombie-processes" class="level2">
<h2>Question: If we omit <code>waitpid()</code> and bash is still running, why there are no zombie processes?</h2>
<p>After all, this is how zombie processes are created.</p>
<p>What are we missing?</p>
</section>
<section id="answer-if-we-omit-waitpid-and-bash-is-still-running-why-there-are-no-zombie-processes" class="level2">
<h2>Answer: If we omit <code>waitpid()</code> and bash is still running, why there are no zombie processes?</h2>
<p>When a child process finishes, the parent is notified with <code>SIGCHLD</code>. Bash calls <code>wait</code> system call in <code>SIGCHLD</code> handler, which allows to read process exit code and remove it from list of processes.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* sigchld_handler () flushes at least one of the children that we are</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co">   waiting for.  It gets run when we have gotten a SIGCHLD signal. */</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> sighandler sigchld_handler(<span class="dt">int</span> sig) {</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> n, oerrno;</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    oerrno = errno;</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    REINSTALL_SIGCHLD_HANDLER;</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    sigchld++;</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    n = <span class="dv">0</span>;</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (queue_sigchld == <span class="dv">0</span>)</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>        n = waitchld (-<span class="dv">1</span>, <span class="dv">0</span>);</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    errno = oerrno;</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    SIGRETURN (n);</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</section>
<section id="question-will-zombie-process-be-created" class="level2">
<h2>Question: Will zombie process be created?</h2>
<p>The <code>exec</code> command calls one of <code>exec*()</code> system calls, which causes current process to execute different program, by replacing the code section of the current process and reinitializing process memory.</p>
<p>The <code>/usr/bin/sleep</code> simply wait the specified number of seconds</p>
<p>The questions are:</p>
<ul class="incremental">
<li><strong>Will zombie process be created in the below case?</strong></li>
<li><strong>If so, then why will it be created?</strong></li>
<li><strong>If so, how long will it exist in a zombie state?</strong></li>
</ul>
<div class="sourceCode" id="cb38"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>$ <span class="ex">/usr/bin/sleep</span> 5 <span class="kw">&amp;</span>        </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>$ <span class="bu">exec</span> /usr/bin/sleep 3600</span></code></pre></div>
</section>
<section id="answer-will-zombie-process-be-created" class="level2">
<h2>Answer: Will zombie process be created?</h2>
<div class="sourceCode" id="cb39"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>$ <span class="ex">/usr/bin/sleep</span> 5 <span class="kw">&amp;</span>         # <span class="ex">spawn</span> child</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>$ <span class="bu">exec</span> /usr/bin/sleep 3600   # replace bash with sleep - erases signal handler</span></code></pre></div>
<p>Answers:</p>
<ul class="incremental">
<li><strong>Will zombie process be created in the below case?</strong>
<ul class="incremental">
<li>Yes.</li>
</ul></li>
<li><strong>Why it will be created</strong>
<ul class="incremental">
<li>Because <code>sleep</code> does not implement <code>SIGCHLD</code> signal handler.</li>
</ul></li>
<li><strong>How long will it exist in a zombie state</strong>
<ul class="incremental">
<li>The child executes for <code>5</code> seconds, the parent <code>3600</code> seconds. The child will be in zombie state <code>3595</code> seconds.</li>
</ul></li>
</ul>
</section>
<section id="detaching-processes-from-the-shell" class="level2">
<h2>Detaching processes from the shell</h2>
<p>Runs <code>COMMAND</code>, redirects <code>stdout</code> and <code>stderr</code> to files in order to avoid termination from closed terminal and removes the <code>PID</code> from bash job list, which will prevent bash from propagating <code>SIGHUP</code>.</p>
<pre><code>$ COMMAND &gt;file 2&gt;file &amp;
$ disown PID</code></pre>
<p>Runs <code>COMMAND</code>, but prevents it from receiving <code>SIGHUP</code>, also redirects the <code>stdin</code> and <code>stdout</code>.</p>
<pre><code>$ nohup COMMAND &amp;</code></pre>
<p>Runs process with the help of <code>screen</code> program, which thanks to <code>-d</code> option will disconnect itself from the <code>bash</code> process.</p>
<pre><code>$ screen -d -m COMMAND</code></pre>
</section>
<section id="example-programs---watch" class="level2">
<h2>Example programs - <code>watch</code></h2>
<p>Executes a program periodically, showing output fullscreen.</p>
<p>Show processes periodically:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>$ <span class="ex">watch</span> ps aux</span></code></pre></div>
<p>Show memory usage in real time:</p>
<pre class="bas"><code>$ watch -n0 df</code></pre>
</section>
<section id="task-detaching-from-the-terminal" class="level2">
<h2>Task: Detaching from the terminal</h2>
<ol class="incremental" type="1">
<li>Run <code>tar</code> program so that it would compress the selected directory located in home directory into <code>~/archive.tar.gz</code> every minute. The process should not be terminated after closing the terminal.</li>
<li>If the process survived after closing the terminal, kill it with <code>kill</code> program.</li>
</ol>
<p>You can get the <code>PID</code> of the process using <code>ps</code> program or <code>pidof</code>.</p>
</section>
</section>
<section id="input-and-output" class="level1">
<h1>Input and output</h1>
<section id="standard-input-output-and-error" class="level2">
<h2>Standard input, output and error</h2>
<p>Bash is started with 3 file descriptors open pointing to the terminal, numbered <code>0</code>, <code>1</code> and <code>2</code>. They are called standard input, standard output and standard error stream.</p>
<p>The <code>cat</code> program will block, waiting for input from <code>0</code>.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">cat</span></span></code></pre></div>
<p>The <code>echo</code> program will write to <code>1</code>.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>$ <span class="bu">echo</span> hello</span></code></pre></div>
<p>The <code>ls</code> program will write errors to <code>2</code></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">ls</span> --cookies</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="ex">ls</span>: unrecognized option <span class="st">&#39;--cookies&#39;</span></span></code></pre></div>
</section>
<section id="redirecting-input" class="level2">
<h2>Redirecting input</h2>
<p>You can start process with a file descriptor pointing to a file instead of a terminal</p>
<p>Start <code>cat</code> with <code>foo</code> file as standard input</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">cat</span> <span class="op">&lt;</span> foo</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="ex">bar</span></span></code></pre></div>
<p>Start <code>echo</code> with <code>foo</code> file as standard output</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>$ <span class="bu">echo</span> bar <span class="op">&gt;</span> foo    # will create ovewrite the <span class="st">&#39;foo&#39;</span> file</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>$ <span class="bu">echo</span> bar <span class="op">&gt;&gt;</span> foo   # will append to the <span class="kw">`</span><span class="ex">foo</span><span class="kw">`</span> file</span></code></pre></div>
<p>Start <code>ls</code> with <code>foo</code> file as standard error stream.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">ls</span> --cookies <span class="op">2&gt;</span> foo</span></code></pre></div>
</section>
<section id="opening-other-file-descriptos" class="level2">
<h2>Opening other file descriptos</h2>
<p>The <code>0</code>, <code>1</code> and <code>2</code> are just arbitrary numbers. You can open other file descriptors if you want.</p>
<p>Run <code>echo</code> process with file descriptor <code>5</code> pointing to <code>foo</code> file.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>$ <span class="bu">echo</span> bar <span class="op">5&gt;</span>foo</span></code></pre></div>
<p>Run <code>read</code> command with file descriptor <code>13</code> pointing to <code>foo</code> file and read a line from descriptor <code>13</code> into variable <code>bar</code></p>
<div class="sourceCode" id="cb52"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>$ <span class="bu">read</span> -u 13 <span class="va">bar</span> 13<span class="op">&lt;</span> <span class="ex">foo</span></span></code></pre></div>
</section>
<section id="heredoc" class="level2">
<h2>HEREDOC</h2>
<p>You can run a child process with the standard input pointing to temporary file created by <code>bash</code> with desired contents:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">cat</span> <span class="op">&lt;&lt;EOF</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>abcdef</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>abcdef</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="op">EOF</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="ex">abcdef</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="ex">abcdef</span></span></code></pre></div>
<div class="sourceCode" id="cb54"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">ls</span> -l /proc/self/fd <span class="op">&lt;&lt;&lt;</span> <span class="st">&quot;foo&quot;</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="ex">lr-x------</span> 64 jane 21 mar  0:18 0 -<span class="op">&gt;</span> /tmp/sh-thd.PCaGIA (deleted)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="ex">lrwx------</span> 64 jane 21 mar  0:18 1 -<span class="op">&gt;</span> /dev/pts/9</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="ex">lrwx------</span> 64 jane 21 mar  0:18 2 -<span class="op">&gt;</span> /dev/pts/9</span></code></pre></div>
</section>
<section id="what-stdin-stdout-and-stderr-really-are" class="level2">
<h2>What stdin, stdout and stderr really are?</h2>
<p>You can check the opened file descriptors of a <code>bash</code> process in the following way:</p>
<pre><code>$ ls -l /proc/$(pidof -s bash)/fd
lrwx------ 64 john 20 mar 22:13 0 -&gt; /dev/pts/9
lrwx------ 64 john 20 mar 22:13 1 -&gt; /dev/pts/9
lrwx------ 64 john 20 mar 22:13 2 -&gt; /dev/pts/9
lrwx------ 64 john 20 mar 23:20 255 -&gt; /dev/pts/9</code></pre>
<p>As you can see three open file descriptors, stdin (<code>0</code>), stdout (<code>1</code>) and stderr (<code>2</code>), point to <code>/dev/pts/9</code>, which is a <strong>pseudoterminal slave</strong>.</p>
<p>These are examples of an character device. A character device acts like a regular file, but instead of accessing the hard drive, a different specific functionality will be invoked in the kernel, when you write and read from it.</p>
</section>
<section id="the-pseudoterminal-master-and-slave" class="level2">
<h2>The pseudoterminal master and slave</h2>
<p>The terminal emulator opens the <code>/dev/ptmx</code>, creates a pseudoterminal slave <code>/dev/pts/X</code>, forks a child bash process with <code>0</code>, <code>1</code> and <code>2</code> file descriptors set to <code>/dev/pts/X</code>.</p>
<p><img src="assets/pseudoterminal.svg" /></p>
</section>
<section id="question-can-you-open-a-file-in-a-bash-process" class="level2">
<h2>Question: Can you open a file in a <code>bash</code> process?</h2>
<p>In other words how can we open a file directly in <code>bash</code> process?</p>
<p>Is there an equivalent of:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> fd = open(<span class="st">&quot;foo.txt&quot;</span>, O_RDONLY, <span class="dv">0</span>);</span></code></pre></div>
<p>?</p>
</section>
<section id="answer-can-you-open-a-file-in-a-bash-process" class="level2">
<h2>Answer: Can you open a file in a <code>bash</code> process?</h2>
<p>You can use <code>exec</code> command.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>$ <span class="bu">exec</span> <span class="op">44&lt;</span> foo      # calls open(<span class="st">&quot;foo&quot;</span>, O_RDONLY, 0)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>$ <span class="bu">read</span> <span class="va">line</span> <span class="op">&lt;&amp;44</span>    # <span class="ex">calls</span> read(44, ...)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>$ <span class="bu">read</span> <span class="va">line</span> <span class="op">&lt;&amp;44</span>    # <span class="ex">calls</span> read(44, ...)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>$ <span class="bu">exec</span> <span class="op">44&lt;</span><span class="kw">&amp;</span> <span class="ex">-</span>       # calls close(44)</span></code></pre></div>
<p>Writing is also possible:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>$ <span class="bu">exec</span> <span class="op">44&gt;</span> foo      # calls open(<span class="st">&quot;foo&quot;</span>, O_WRONLY, 0)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>$ <span class="bu">echo</span> line <span class="op">&gt;&amp;44</span>    # calls write(44, ...)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>$ <span class="bu">echo</span> line <span class="op">&gt;&amp;44</span>    # calls write(44, ...)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>$ <span class="bu">exec</span> <span class="op">44&gt;</span><span class="kw">&amp;</span> <span class="ex">-</span>       # calls close(44)</span></code></pre></div>
</section>
<section id="question-what-happens-if-you-close-file-descriptor-2-for-bash-process" class="level2">
<h2>Question: What happens if you close file descriptor 2 for bash process</h2>
<p>Try this command:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>$ <span class="bu">exec</span> <span class="op">2&gt;</span><span class="kw">&amp;</span><span class="ex">-</span></span></code></pre></div>
<p>Then type:</p>
<pre><code>ls&lt;enter&gt;</code></pre>
</section>
<section id="answer-what-happens-if-you-close-file-descriptor-2-for-bash-process" class="level2">
<h2>Answer: What happens if you close file descriptor 2 for bash process</h2>
<p>Bash prints its prompt to descriptor <code>2</code> (standard error stream). So if we close it, we will see no prompt. But we standard input is still open, and also standard output, so typing <code>ls&lt;enter&gt;</code> is returns the directory listing.</p>
</section>
</section>
<section id="pipes" class="level1">
<h1>Pipes</h1>
<section id="the-unix-philosophy" class="level2">
<h2>The Unix philosophy</h2>
<ol class="incremental" type="1">
<li>Write programs that <strong>do one thing and do it well</strong></li>
<li>Write <strong>programs</strong> to <strong>work together</strong></li>
<li>Write programs to handle <strong>text</strong> streams, because that <strong>is an universal interface</strong></li>
</ol>
<p>To realize this philosophy we need pipes.</p>
</section>
<section id="the-concept-of-pipe" class="level2">
<h2>The concept of pipe</h2>
<p>The <code>|</code> operator creates a <code>pipe</code> between 2 processes.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">cat</span> foo.txt <span class="kw">|</span> <span class="fu">grep</span> bar</span></code></pre></div>
<p>The <code>pipe</code> endpoints are connected to descriptor <code>1</code> of the first process and <code>0</code> of the second process.</p>
<p><img src="assets/pipe.svg" /></p>
</section>
<section id="examples" class="level2">
<h2>Examples</h2>
<p>Count lines in a file</p>
<pre><code>$ cat file | wc -l</code></pre>
<p>Replace ‘small’ with ‘BIG’</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>$ <span class="bu">echo</span> small <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&quot;s/small/BIG&quot;</span></span></code></pre></div>
<p>Remove all <code>.txt</code> files in current working directory and child directories</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">find</span> . -name <span class="st">&quot;*.txt&quot;</span> <span class="kw">|</span> <span class="fu">xargs</span> -rm -f</span></code></pre></div>
</section>
<section id="example-programs---often-used-in-pipes" class="level2">
<h2>Example programs - often used in pipes</h2>
<p>Below are programs that are most useful with pipes:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">wc</span> -l             # count number of lines in standard input</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">xargs</span> -n1 CMD     # execute CMD for each token from standard input</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">cat</span>               # pass everything from standard input to standard output</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">grep</span> pattern      # print to standard output only lines that contain <span class="st">&#39;pattern&#39;</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">sed</span> <span class="st">&#39;s/a/B/&#39;</span>      # replace <span class="st">&#39;a&#39;</span> with <span class="st">&#39;B&#39;</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">head</span> -n 20        # print first 20 lines</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">tail</span>              # print last 20 lines</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">less</span>              # view contents of standard input interactively</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">more</span>              # view contents of standard input interactively (you can<span class="st">&#39;t go back)</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a><span class="st">$ most              # view contents of standard input interactively (you can go sideways)</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a><span class="st">$ tr x              # replace &#39;</span>x<span class="st">&#39; with &#39;</span>X<span class="st">&#39;</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a><span class="st">$ bc                # An arbitrary precision calculator</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a><span class="st">$ yes               # Prints &#39;</span>y<span class="st">&#39; to standard output</span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a><span class="st">$ cut               # remove section from each line of files</span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a><span class="st">$ tee               # read from standard input and write to standard output and files</span></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a><span class="st">$ xclip             # copy standard input to clipboard</span></span></code></pre></div>
</section>
<section id="task-covid-prompt" class="level2">
<h2>Task: Covid prompt</h2>
<p>Modify your <code>~/.bashrc</code> so that you can see a live counter of total COVID cases world wide in your prompt. Create a tiny script that will run <code>curl</code> (in background), which will save current cases from the API in the <code>~/.cases</code> file. Then use <code>cat</code> to display it in the prompt.</p>
<pre><code>curl --location -s --request GET &#39;https://api.covid19api.com/summary&#39;</code></pre>
<p>You can modify your prompt in <code>.bashrc</code></p>
<div class="sourceCode" id="cb67"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">foo ()</span> <span class="kw">{</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>    <span class="va">PS1=</span><span class="st">&quot;</span><span class="va">$(</span><span class="fu">cat</span> ~/.cases<span class="va">)</span><span class="st"> </span><span class="dt">\$</span><span class="st">&quot;</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="va">PROMPT_COMMAND=</span>foo</span></code></pre></div>
<p>You will most likely need <code>jq</code> to parse <code>.json</code> or maybe <code>grep</code>.</p>
</section>
</section>
<section id="subshells" class="level1">
<h1>Subshells</h1>
<section id="what-is-a-subshell" class="level2">
<h2>What is a subshell?</h2>
<p>A subshell is a child Bash process, which is spawned to execute a given command. Below you can see example operators that will cause Bash to create a subshell</p>
<pre><code>(  )</code></pre>
<pre><code>&lt;(  )</code></pre>
<pre><code>$(  )</code></pre>
<pre><code>&gt;(  )</code></pre>
<pre><code>|</code></pre>
</section>
<section id="question-what-is-the-difference-when-we-run-ls-in-a-subshell" class="level2">
<h2>Question: What is the difference when we run <code>ls</code> in a subshell</h2>
<p>We can check the difference between these 2 commands</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">ls</span></span></code></pre></div>
<div class="sourceCode" id="cb74"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>$ <span class="kw">(</span><span class="fu">ls</span><span class="kw">)</span></span></code></pre></div>
<p>By running <code>strace</code></p>
<div class="sourceCode" id="cb75"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>$ <span class="ex">strace</span> -fe execve,clone bash</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">ls</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>$ <span class="kw">(</span><span class="fu">ls</span><span class="kw">)</span></span></code></pre></div>
</section>
<section id="answer-what-is-the-difference-when-we-run-ls-in-a-subshell" class="level2">
<h2>Answer: What is the difference when we run <code>ls</code> in a subshell</h2>
<p>There is no difference:</p>
<pre><code>$ ls
clone(child_stack=NULL, flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD, child_tidptr=0x7f5eea1e1850) = 865843
[pid 865843] execve(&quot;/usr/bin/ls&quot;, [&quot;ls&quot;], 0x558097fc94b8 /* 76 vars */) = 0
...
$ (ls)
clone(child_stack=NULL, flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD, child_tidptr=0x7f5eea1e1850) = 865860
[pid 865860] execve(&quot;/usr/bin/ls&quot;, [&quot;ls&quot;], 0x558097fc94d8 /* 76 vars */) = 0
...</code></pre>
<p><img src="assets/facepalm.jpg" /></p>
</section>
<section id="answer-what-is-the-difference-when-we-run-ls-in-a-subshell-1" class="level2">
<h2>Answer: What is the difference when we run <code>ls</code> in a subshell</h2>
<p>But actually, there is (complex commands):</p>
<pre><code>$ ls; ls
clone(child_stack=NULL, flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD, child_tidptr=0x7f5eea1e1850) = 867887
[pid 867887] execve(&quot;/usr/bin/ls&quot;, [&quot;ls&quot;], 0x558097fc9528 /* 76 vars */) = 0
clone(child_stack=NULL, flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD, child_tidptr=0x7f5eea1e1850) = 867888
[pid 867888] execve(&quot;/usr/bin/ls&quot;, [&quot;ls&quot;], 0x558097fc9528 /* 76 vars */) = 0
...
(ls; ls)
clone(child_stack=NULL, flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHL , child_tidptr=0x7f5eea1e1850) = 867945
[pid 867945] clone(child_stack=NULL, flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD, child_tidptr=0x7f5eea1e1850) = 867946
[pid 867946] execve(&quot;/usr/bin/ls&quot;, [&quot;ls&quot;], 0x558097fc9528 /* 76 vars */) = 0
[pid 867945] execve(&quot;/usr/bin/ls&quot;, [&quot;ls&quot;], 0x558097fc9528 /* 76 vars */) = 0
...</code></pre>
</section>
<section id="subshells-and-cd" class="level2">
<h2>Subshells and <code>cd</code></h2>
<p>The <code>cd</code> is not executed normally as a separate process, but with a subshell it is.</p>
<pre><code>$ cd
$ (cd)
clone(child_stack=NULL, flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD, child_tidptr=0x7f5eea1e1850) = 871287
strace: Process 871287 attached
[pid 871287] +++ exited with 0 +++
--- SIGCHLD {si_signo=SIGCHLD, si_code=CLD_EXITED, si_pid=871287, si_uid=1000, si_status=0, si_utime=0, si_stime=0} ---
--- SIGWINCH {si_signo=SIGWINCH, si_code=SI_KERNEL} ---</code></pre>
</section>
<section id="subshells---explanation" class="level2">
<h2>Subshells - explanation</h2>
<p>When we call the following command</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>$ <span class="kw">(</span><span class="fu">ls</span><span class="kw">;</span> <span class="fu">ls</span><span class="kw">)</span></span></code></pre></div>
<p>The following happens:</p>
<p><img src="assets/subshell.svg" /></p>
</section>
<section id="subshells---optimization" class="level2">
<h2>Subshells - optimization</h2>
<p>Bash will omit the second <code>fork()</code> is it is not neccessary.</p>
<pre><code>$ (ls)</code></pre>
<p><img src="assets/subshellsimple.svg" /></p>
</section>
<section id="different-cases-for-optimization" class="level2">
<h2>Different cases for optimization</h2>
<p>Bash omits additional <code>fork()</code>, depending on the use case.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>$ <span class="kw">(</span><span class="fu">pstree</span><span class="kw">)</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="ex">systemd</span>─┬─...</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>        ├─<span class="ex">sshd</span>───sshd───sshd───bash───pstree</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>$ <span class="kw">(</span><span class="bu">:</span><span class="kw">;</span><span class="fu">pstree</span><span class="kw">)</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="ex">systemd</span>─┬─...</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>        ├─<span class="ex">sshd</span>───sshd───sshd───bash───bash───pstree</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">bash</span> -c <span class="st">&#39;pstree&#39;</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a><span class="ex">systemd</span>─┬─...</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>        ├─<span class="ex">sshd</span>───sshd───sshd───bash───pstree</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>$ <span class="bu">echo</span> pstree <span class="kw">|</span> <span class="fu">bash</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a><span class="ex">systemd</span>─┬─...</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>        ├─<span class="ex">sshd</span>───sshd───sshd───bash───bash───pstree</span></code></pre></div>
</section>
<section id="operator" class="level2">
<h2>Operator <code>&lt;()</code></h2>
<p>The <code>&lt;()</code> operator works by running a command specified in brackets and inserts a temporary named pipe in their place.</p>
<p>You can see the result is a named pipe:</p>
<pre><code>$ ls -l &lt;(echo)</code></pre>
<p>For example to find <code>bash</code> in <code>ps</code> output:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">grep</span> bash <span class="op">&lt;(</span><span class="fu">ps</span><span class="op">)</span></span></code></pre></div>
<p>Or if you want to execute a script located at <code>url</code></p>
<div class="sourceCode" id="cb84"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">bash</span> <span class="op">&lt;(</span><span class="ex">curl</span> -s https://raw.githubusercontent.com/czarnota/bash-snake/master/snake<span class="op">)</span></span></code></pre></div>
</section>
<section id="operator-1" class="level2">
<h2>Operator <code>$()</code></h2>
<p>Captures the standard output of the command in brackets and “expands” it into the shell</p>
<p>Install linux headers for current linux version:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">sudo</span> apt install linux-headers-<span class="va">$(</span><span class="fu">uname</span> -r<span class="va">)</span></span></code></pre></div>
<p>Kill <code>vim</code>, by looking up its <code>PID</code> using <code>pidof</code>:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>$ <span class="bu">kill</span> <span class="va">$(</span><span class="fu">pidof</span> vim<span class="va">)</span></span></code></pre></div>
<p>Save list of files in <code>files</code> variable</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="va">files=</span><span class="st">&quot;</span><span class="va">$(</span><span class="fu">ls</span> -a<span class="va">)</span><span class="st">&quot;</span></span></code></pre></div>
</section>
<section id="question-why-doesnt-it-work" class="level2">
<h2>Question: Why doesn’t it work?</h2>
<p>The <code>read</code> command reads standard input and places it in <code>var</code> variable. So <code>var</code> should contain <code>hello</code>, but it doesn’t?</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>$ <span class="bu">echo</span> hello <span class="kw">|</span> <span class="bu">read</span> <span class="va">var</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>$ <span class="bu">echo</span> <span class="st">&quot;hello:</span><span class="va">$var</span><span class="st">&quot;</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="ex">hello</span>:</span></code></pre></div>
</section>
<section id="answer-why-doesnt-it-work" class="level2">
<h2>Answer: Why doesn’t it work?</h2>
<p>The <code>echo hello | read var</code> is executed in a subshell. Execute the following commands to confirm:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>$ <span class="ex">strace</span> -f -e fork,execve,clone bash</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>$ <span class="bu">echo</span> hello <span class="op">&gt;</span> var_value</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>$ <span class="bu">read</span> <span class="va">var</span> <span class="op">&lt;</span> <span class="ex">var_value</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>$ <span class="bu">echo</span> <span class="st">&quot;hello:</span><span class="va">$var</span><span class="st">&quot;</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="ex">hello</span>:hello</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">cat</span> var_value <span class="kw">|</span> <span class="bu">read</span> <span class="va">var2</span>         # <span class="va">read</span> <span class="va">is</span> <span class="va">done</span> <span class="va">in</span> <span class="va">a</span> <span class="va">subshell</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>$ <span class="bu">echo</span> <span class="va">$var2</span></span></code></pre></div>
<p>So there is a difference between these 2 commands:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="bu">read</span> <span class="va">x</span> <span class="op">&lt;</span> <span class="op">&lt;(</span><span class="bu">echo</span> y<span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb91"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> y <span class="kw">|</span> <span class="bu">read</span> <span class="va">x</span></span></code></pre></div>
</section>
<section id="task-search-and-replace" class="level2">
<h2>Task: Search and replace</h2>
<ol class="incremental" type="1">
<li>Imagine that you have just become the maintainer of the famous Symfony project.</li>
</ol>
<pre><code>http://github.com/symfony/symfony</code></pre>
<ol class="incremental" start="2" type="1">
<li>Currently every <code>.php</code> file has the following copyright</li>
</ol>
<pre><code>  (c) Fabien Potencier &lt;fabien@symfony.com&gt;</code></pre>
<ol class="incremental" start="3" type="1">
<li>Update the copyright by adding new line below</li>
</ol>
<pre><code>  (c) Fabien Potencier &lt;fabien@symfony.com&gt;
  (c) Your Name &lt;yourname@example.com&gt;</code></pre>
<p>You may need to use <code>sed -i</code> and <code>grep -R -l</code>.</p>
</section>
</section>
<section id="glob-patterns" class="level1">
<h1>Glob patterns</h1>
<section id="operator-2" class="level2">
<h2>Operator <code>*</code></h2>
<p>The <code>*</code> operator matches any charaters.</p>
<p>The shell will replace the pattern with all files that match it.</p>
<p>Examples:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">mv</span> *.txt dest</span></code></pre></div>
<div class="sourceCode" id="cb96"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>$ <span class="bu">echo</span> *</span></code></pre></div>
<div class="sourceCode" id="cb97"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">tar</span> -czffiles.tar.gz *</span></code></pre></div>
<div class="sourceCode" id="cb98"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">rm</span> -fr *.o</span></code></pre></div>
</section>
<section id="operator-3" class="level2">
<h2>Operator <code>?</code></h2>
<p>The <code>?</code> operator matches a single character.</p>
<p>The shell will replace the pattern with all files that match it.</p>
<p>Examples:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">mv</span> *.??? dest</span></code></pre></div>
<div class="sourceCode" id="cb100"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">rm</span> *.?o</span></code></pre></div>
<div class="sourceCode" id="cb101"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">tar</span> -czffiles.tar.gz ??????</span></code></pre></div>
</section>
<section id="operator-4" class="level2">
<h2>Operator <code>[]</code></h2>
<p>The <code>[]</code> operator matches a single matching character from the set.</p>
<p>The shell will replace the pattern with all files that match it.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>$ <span class="bu">echo</span> a[bczd]</span></code></pre></div>
<div class="sourceCode" id="cb103"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">cp</span> *.[mp3tx][mp3tx][mp3tx]</span></code></pre></div>
<div class="sourceCode" id="cb104"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">rm</span> [a-z]</span></code></pre></div>
</section>
<section id="operator-.." class="level2">
<h2>Operator <code>{..}</code></h2>
<p>The <code>{}</code> operator expands to numbers or characters of the specified range.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>$ <span class="bu">echo</span> <span class="dt">{1..10}</span></span></code></pre></div>
<div class="sourceCode" id="cb106"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">rm</span> <span class="dt">{1..10}{1..10}</span></span></code></pre></div>
<div class="sourceCode" id="cb107"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">touch</span> <span class="dt">{0..9}{a..z}</span></span></code></pre></div>
</section>
<section id="operator-5" class="level2">
<h2>Operator <code>{,}</code></h2>
<p>You can manually specify elements of the range, by specifying elements and separating them by a comma:</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">mv</span> path/to/<span class="dt">{file1,file2}</span></span></code></pre></div>
<div class="sourceCode" id="cb109"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">mv</span> path/to/file1.txt<span class="dt">{,.bak}</span></span></code></pre></div>
<div class="sourceCode" id="cb110"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">touch</span> path/to/<span class="dt">{przemek,mike,tom}{1..10}</span></span></code></pre></div>
</section>
<section id="operator-6" class="level2">
<h2>Operator <code>~</code></h2>
<p>The <code>~</code> expands to user’s home firectory:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>$ <span class="bu">echo</span> ~/directory</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="ex">/home/john/directory</span></span></code></pre></div>
<p>This works the same as <code>$HOME</code> variable:</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>$ <span class="bu">echo</span> <span class="va">$HOME</span>/directory</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="ex">/home/john/directory</span></span></code></pre></div>
<p>You can disable the expansion using <code>""</code>:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>$ <span class="bu">echo</span> <span class="st">&quot;~/directory&quot;</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="ex">~/directory</span></span></code></pre></div>
</section>
<section id="task-downloading-articles" class="level2">
<h2>Task: Downloading articles</h2>
<p>You can download an article about a day from Wikipedia in <code>.pdf</code> format from this link:</p>
<pre><code>https://en.Wikipedia.org/api/rest_v1/page/pdf/April_26</code></pre>
<ol class="incremental" type="1">
<li>Download all articles about days from the month of your birth.</li>
<li>Downloaded files should have a <code>.pdf</code> suffix.</li>
<li>Pack downloaded files into a <code>.zip</code> archive.</li>
</ol>
</section>
</section>
<section id="error-codes" class="level1">
<h1>Error codes</h1>
<section id="operator-7" class="level2">
<h2>Operator <code>||</code></h2>
<p>Executes a command only if the first command fails.</p>
<p>Print <code>not found</code>, if there is no line in <code>file</code> containing <code>hello</code>:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">grep</span> hello file <span class="kw">||</span> <span class="bu">echo</span> not found</span></code></pre></div>
<p>Download <code>file1</code>, if it fails download <code>file2</code></p>
<div class="sourceCode" id="cb116"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">wget</span> http://a.com/file1 <span class="kw">||</span> <span class="fu">wget</span> http://b.com/file2</span></code></pre></div>
</section>
<section id="operator-8" class="level2">
<h2>Operator <code>&amp;&amp;</code></h2>
<p>Executes a command only if the first command succeeds</p>
<p>Print <code>found</code>, if there is a line in <code>file</code> containing <code>hello</code>:</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">grep</span> hello file <span class="kw">&amp;&amp;</span> <span class="bu">echo</span> found</span></code></pre></div>
<p>Remove <code>file</code> and if it was removed successfully, then create it again:</p>
<pre><code>$ rm file &amp;&amp; touch file</code></pre>
<p>Extract <code>f.tar.gz</code> archive only if it was downloaaded successfully</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>$ <span class="fu">wget</span> http://x.com/f.tar.gz <span class="kw">&amp;&amp;</span> <span class="fu">tar</span> -czvf f.tar.gz</span></code></pre></div>
</section>
<section id="question-what-is-going-to-happen" class="level2">
<h2>Question: What is going to happen?</h2>
<p>What will be printed in the following scenario:</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>$ <span class="bu">echo</span> 1 <span class="kw">||</span> <span class="bu">echo</span> 2 <span class="kw">&amp;&amp;</span> <span class="bu">echo</span> 3</span></code></pre></div>
</section>
<section id="answer-what-is-going-to-happen" class="level2">
<h2>Answer: What is going to happen?</h2>
<p>The result is:</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>$ <span class="bu">echo</span> 1 <span class="kw">||</span> <span class="bu">echo</span> 2 <span class="kw">&amp;&amp;</span> <span class="bu">echo</span> 3</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span></span></code></pre></div>
<p>Although the boolean logic would suggest the following order:</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>$ <span class="bu">echo</span> 1 <span class="kw">||</span> <span class="kw">(</span> <span class="bu">echo</span> 2 <span class="kw">&amp;&amp;</span> <span class="bu">echo</span> 3 <span class="kw">)</span></span></code></pre></div>
<p>The actual order is always left to right:</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>$ <span class="kw">(</span> <span class="kw">(</span> <span class="bu">echo</span> 1 <span class="kw">||</span>  <span class="bu">echo</span> 2 <span class="kw">)</span> <span class="kw">&amp;&amp;</span> <span class="bu">echo</span> 3 <span class="kw">)</span></span></code></pre></div>
</section>
<section id="writing-scripts-in-bash-programming-language" class="level2">
<h2>Writing scripts in Bash programming language</h2>
</section>
<section id="wielozadaniowość-na-wielu-procesorachrdzeniach" class="level2">
<h2>Wielozadaniowość na wielu procesorach/rdzeniach</h2>
<p>W przypadku wielu procesorów, system operacyjny może uruchamiać procesy rzeczywiście równolegle</p>
<p><img src="assets/7.svg" /></p>
</section>
<section id="wielozadaniowość-na-wielu-procesorachrdzeniach-1" class="level2">
<h2>Wielozadaniowość na wielu procesorach/rdzeniach</h2>
<p>W praktyce procesy mogą być uruchamiane na różnych rdzeniach procesora.</p>
<p><img src="assets/9.svg" /></p>
</section>
<section id="afiniczność-procesora" class="level2">
<h2>Afiniczność procesora</h2>
<p>W Linuksie możemy określić na których procesorach będzie wykonywany proces</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>$ <span class="ex">taskset</span> -p 0x11 9726</span></code></pre></div>
<p>Podobne ustawienie istnieje również w menedżerze zadań systemu Windows</p>
<p><img src="assets/affinity.png" /></p>
</section>
</section>
<section id="procesy" class="level1">
<h1>Procesy</h1>
<section id="procesy-w-systemie-linux" class="level2">
<h2>Procesy w systemie Linux</h2>
<p>Procesem nazywamy program, który się wykonuje. W skład procesu wchodzą:</p>
<ul class="incremental">
<li><strong>Stan procesora (rejestry).</strong> Dla <code>x86_64</code> są to:
<ul class="incremental">
<li><code>rbp</code> - wskaźnik początku stosu</li>
<li><code>rsp</code> - wskaźnik końca stosu (ang. Stack pointer)</li>
<li><code>rip</code> - wskaźnik aktualnej instrukcji (ang. Program counter)</li>
<li><code>rflags</code> - rejest flag procesora</li>
<li>rejestry ogólnego przeznaczenia: <code>rax</code>, <code>rcx</code>, <code>rdx</code>, <code>rbx</code>, <code>rsi</code>, <code>rdi</code>, <code>r8</code>-<code>r15</code></li>
</ul></li>
<li><strong>Pamięć wirtualna</strong> (Tabela stron) (wskazywana przez rejestr <code>CR3</code>)</li>
<li><strong>Deskryptory plików</strong>, czyli (najważniejsze):
<ul class="incremental">
<li>pliki (otwarte za pomocą <code>open()</code>)</li>
<li>gniazda sieciowe (otwarte za pomocą <code>socket()</code>, <code>accept()</code>)</li>
<li>potoki (otwarte za pomocą <code>pipe()</code>)</li>
<li>demultiplexery zdarzeń (otwarte za pomocą <code>epoll_create()</code>)</li>
</ul></li>
<li>Inne struktury danych istotne dla jądra Linux</li>
</ul>
</section>
<section id="podglądanie-procesów-w-systemie" class="level2">
<h2>Podglądanie procesów w systemie</h2>
<p>W systemie Linux, uruchomione procesy możemy zobaczyć za pomocą programu <code>ps</code></p>
<pre class="console"><code>$ ps
  PID TTY           TIME CMD
  896 ttys000    0:00.10 -bash
 1073 ttys001    0:00.08 -bash
 7601 ttys001    0:00.02 bash /Users/hehe/v/e @
 7603 ttys001    1:40.37 nvim
 1074 ttys002    0:00.15 -bash
75444 ttys002    0:00.00 (sleep)
 6110 ttys003    0:00.50 -bash
75450 ttys003    0:00.00 bash /Users/hehe/v/y
 7870 ttys004    0:00.09 -bash
75448 ttys004    0:00.00 sleep 1</code></pre>
<p>Liczba <code>PID</code> to unikalny identyfikator procesu.</p>
</section>
<section id="podglądanie-procesów-w-systemie---top" class="level2">
<h2>Podglądanie procesów w systemie - top</h2>
<p>Programy <code>top</code> oraz <code>htop</code> umożliwają podgląd procesów w czasie rzeczywistym</p>
<pre class="console"><code>$ top
top - 22:20:33 up 56 min,  1 user,  load average: 0,33, 0,52, 0,56
Zadania:razem: 328, działających:   2, śpiących: 326, zatrzymanych:   0, zombie:   0
%CPU:  2,9 uż,  1,8 sy,  0,0 ni, 95,3 be,  0,0 io,  0,0 hi,  0,0 si,  0,0 sk
MiB RAM :  15888,6 razem,   9129,5 wolne,   3037,6 użyte,   3721,6 buf/cache
MiB Swap:   4880,0 razem,   4880,0 wolne,      0,0 użyte.  12497,1 dost. RAM

    PID UŻYTK.    PR  NI    WIRT    REZ    WSP S  %CPU  %PAM     CZAS+ KOMENDA
   1452 hehe       9 -11 2731536  20752  16068 S   8,0   0,1   0:55.86 pulseaudio
   3269 hehe      20   0  522940  55472  40716 R   5,7   0,3   4:34.44 x-terminal-emul
   9773 hehe      20   0  217860  52624  35892 S   4,6   0,3   1:22.04 MainThread
   5321 hehe      20   0 4935640 751040 310720 S   3,4   4,6   4:44.81 firefox
   8058 hehe      20   0  319064  50504  39920 S   2,3   0,3   0:54.45 RDD Process
  34580 hehe      20   0   23400   4224   3288 R   2,3   0,0   0:00.05 top
    287 root      20   0       0      0      0 I   1,1   0,0   0:02.22 kworker/4:1-events
   1903 hehe      20   0 4463536 392068 118248 S   1,1   2,4   1:30.14 gnome-shell
   1989 hehe      20   0  396140   8576   7056 S   1,1   0,1   0:20.24 ibus-daemon
   2286 hehe      20   0 5165376 252416  77816 S   1,1   1,6   0:09.15 dropbox
      1 root      20   0  170040  14056   8280 S   0,0   0,1   0:01.51 systemd</code></pre>
</section>
<section id="podglądanie-procesów-w-systemie---pseudo-system-plików-proc" class="level2">
<h2>Podglądanie procesów w systemie - pseudo system plików /proc</h2>
<pre class="console"><code>$ ls /proc
1   42   129  289  978   1259  1580  2103  8238   34694          kpageflags
2   43   132  290  981   1285  1627  2104  8403   34695          loadavg
3   44   133  291  986   1286  1630  2105  8648   35412          locks
4   46   136  349  990   1301  1762  2106  8808   35848          mdstat
6   47   138  350  994   1358  1780  2107  8827   35849          meminfo
8   48   139  351  1009  1374  1850  2109  8968   35855          misc
9   49   142  353  1011  1377  1870  2110  8970   acpi           modules
10  50   150  437  1013  1378  1875  2118  9421   asound         mounts
11  52   153  438  1015  1379  1881  2192  9773   bootconfig     mtrr
12  53   154  491  1017  1380  1888  2194  10510  buddyinfo      net
13  54   159  519  1019  1381  1903  2247  12703  bus            pagetypeinfo
14  55   194  520  1021  1407  1989  2260  13057  cgroups        partitions
15  56   219  522  1023  1411  1993  2286  13159  cmdline        pressure
16  58   221  524  1025  1412  1994  2376  15059  consoles       schedstat
17  59   242  526  1078  1414  1998  2391  19363  cpuinfo        scsi
18  60   244  528  1079  1421  2004  2513  19374  crypto         self
19  61   245  529  1116  1450  2008  2681  27384  devices        slabinfo
20  62   247  620  1117  1452  2016  3269  27437  diskstats      softirqs</code></pre>
</section>
<section id="drzewo-procesów" class="level2">
<h2>Drzewo procesów</h2>
<p>Drzewo procesów możemy ujrzeć za pomocą programu <code>pstree</code></p>
<pre class="console"><code>$ pstree
systemd─┬─ModemManager───2*[{ModemManager}]
        ├─NetworkManager───2*[{NetworkManager}]
        ├─fwupd───4*[{fwupd}]
        ├─gdm3─┬─gdm-session-wor─┬─gdm-x-session─┬─Xorg───{Xorg}
        │      │                 │               ├─gnome-session-b─┬─ssh-agent
        │      │                 │               │                 └─2*[{gnome-session-b}]
        │      │                 │               └─2*[{gdm-x-session}]
        │      │                 └─2*[{gdm-session-wor}]
        │      └─2*[{gdm3}]
        ├─polkitd───2*[{polkitd}]
        ├─systemd─┬─(sd-pam)
        │         ├─tmux: server─┬─bash───bash───nvim─┬─2*[xclip]
        │         │              │                    └─{nvim}
        │         │              ├─bash───bash───sleep
        │         │              ├─bash
        │         │              └─bash─┬─bash
        │         │                     └─pstree
       ...       ...</code></pre>
</section>
</section>
<section id="tworzenie-procesów" class="level1">
<h1>Tworzenie procesów</h1>
<section id="wywołanie-systemowe---fork" class="level2">
<h2>Wywołanie systemowe - <code>fork()</code></h2>
<p>Do tworzenia procesów, służy wywołanie systemowe <code>fork()</code>. Wywołanie <code>fork()</code> tworzy proces potomny, który jest “klonem” procesu rodzica.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> main(<span class="dt">void</span>)</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>   {</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>       printf(<span class="st">&quot;przed utworzeniem</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>--&gt;    <span class="dt">int</span> pid = fork();</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>       ...</span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>   }</span></code></pre></div>
<p>Po wywołaniu <code>fork()</code>:</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>   <span class="co">/* rodzic */</span>                         <span class="co">/* dziecko */</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>   <span class="dt">int</span> main(<span class="dt">void</span>)                       <span class="dt">int</span> main(<span class="dt">void</span>)</span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>   {                                    {</span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>       printf(<span class="st">&quot;przed utworzeniem</span><span class="sc">\n</span><span class="st">&quot;</span>);       printf(<span class="st">&quot;przed utworzeniem</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>--&gt;    <span class="dt">int</span> pid = fork();             --&gt;    <span class="dt">int</span> pid = fork();</span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>       ...                                  ...</span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a>   }                                    }</span></code></pre></div>
</section>
<section id="wartość-zwracana-fork" class="level2">
<h2>Wartość zwracana <code>fork()</code></h2>
<p>Wywołanie <code>fork()</code> w procesie potomnym zwraca <code>0</code>, natomiast w procesie rodzica wartością zwróconą będzie PID procesu potomnego.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>   <span class="co">/* rodzic */</span>                         <span class="co">/* dziecko */</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> main(<span class="dt">void</span>)                       <span class="dt">int</span> main(<span class="dt">void</span>)</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>    {                                    {</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>        printf(<span class="st">&quot;przed utworzeniem</span><span class="sc">\n</span><span class="st">&quot;</span>);       printf(<span class="st">&quot;przed utworzeniem</span><span class="sc">\n</span><span class="st">&quot;</span>)j</span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> pid = fork();                    <span class="dt">int</span> pid = fork();</span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (pid == <span class="dv">0</span>)                        <span class="cf">if</span> (pid == <span class="dv">0</span>)</span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>            printf(<span class="st">&quot;child</span><span class="sc">\n</span><span class="st">&quot;</span>);        --&gt;        printf(<span class="st">&quot;child</span><span class="sc">\n</span><span class="st">&quot;</span>);   </span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>                                 <span class="cf">else</span></span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a> --&gt;        printf(<span class="st">&quot;parent</span><span class="sc">\n</span><span class="st">&quot;</span>);                  printf(<span class="st">&quot;parent</span><span class="sc">\n</span><span class="st">&quot;</span>);  </span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span>;                            <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a>    }                                    }</span></code></pre></div>
<p>Na podstawie wartości zwracanej, możemy określić czy “znajdujemy” się w procesie potomnym czy w procesie rodzica.</p>
</section>
<section id="oczekiwanie-na-zakończenie-procesu-potomnego" class="level2">
<h2>Oczekiwanie na zakończenie procesu potomnego</h2>
<p>Do oczekiwania na zakończenie procesu potomnego służy, wywołanie systemowe <code>wait()</code>, które blokuje program do momentu zakończenia dowolnego procesu potomnego.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>   <span class="co">/* rodzic */</span>                         <span class="co">/* dziecko */</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> main(<span class="dt">void</span>)                       <span class="dt">int</span> main(<span class="dt">void</span>)</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>    {                                    {</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>        printf(<span class="st">&quot;przed utworzeniem</span><span class="sc">\n</span><span class="st">&quot;</span>);       printf(<span class="st">&quot;przed utworzeniem</span><span class="sc">\n</span><span class="st">&quot;</span>)j</span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> pid = fork();                    <span class="dt">int</span> pid = fork();</span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (pid == <span class="dv">0</span>) {                      <span class="cf">if</span> (pid == <span class="dv">0</span>) {</span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>            printf(<span class="st">&quot;child</span><span class="sc">\n</span><span class="st">&quot;</span>);                   printf(<span class="st">&quot;child</span><span class="sc">\n</span><span class="st">&quot;</span>);   </span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {                             } <span class="cf">else</span> {</span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a>            printf(<span class="st">&quot;parent</span><span class="sc">\n</span><span class="st">&quot;</span>);                  printf(<span class="st">&quot;parent</span><span class="sc">\n</span><span class="st">&quot;</span>);  </span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a> --&gt;        wait(NULL);                          wait(NULL);</span>
<span id="cb132-11"><a href="#cb132-11" aria-hidden="true" tabindex="-1"></a>        }                                    }</span>
<span id="cb132-12"><a href="#cb132-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span>;                     --&gt;    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb132-13"><a href="#cb132-13" aria-hidden="true" tabindex="-1"></a>    }                                    }</span></code></pre></div>
</section>
<section id="wait-obsługa-błędów" class="level2">
<h2><code>wait()</code> obsługa błędów</h2>
<p>Wywołanie systemowe <code>wait()</code> zwraca <code>pid</code> zakończonego procesu. Jeżeli wartość jest ujemna to wystąpił błąd. Błąd uzyskać można odczytująć zmienną <code>errno</code>.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>pid = wait(NULL);</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (pid &lt; <span class="dv">0</span>) {</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>    fprintf(stderr, <span class="st">&quot;error: wait: %s</span><span class="sc">\n</span><span class="st">&quot;</span>, strerror(errno));</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> -<span class="dv">1</span>;</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</section>
<section id="wait-odczytanie-wartości-zwracanej" class="level2">
<h2><code>wait()</code> odczytanie wartości zwracanej</h2>
<p>Można odczytać wartość jaką zwrócił proces potomny przekazując wskaźnik jako pierwszy argument wywołania <code>wait()</code>.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> status;</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>pid = wait(&amp;status);</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (pid &lt; <span class="dv">0</span>) {</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>    fprintf(stderr, <span class="st">&quot;error: wait: %s</span><span class="sc">\n</span><span class="st">&quot;</span>, strerror(errno));</span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> -<span class="dv">1</span>;</span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (WIFEXITED(status))</span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>    printf(<span class="st">&quot;dziecko zwróciło: %d</span><span class="sc">\n</span><span class="st">&quot;</span>, WEXITSTATUS(status));</span></code></pre></div>
</section>
<section id="oczekiwanie-na-zakończenie-kilku-procesów-potomnych" class="level2">
<h2>Oczekiwanie na zakończenie kilku procesów potomnych</h2>
<p>Wywołanie systemowe <code>wait()</code> czeka na pierwszy proces potomny, który ulegnie zakończeniu. Jeżeli utworzonych zostało więcej procesów potomnych, to należy ponowić oczekiwanie.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (true) {</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> pid = wait(NULL);</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (pid &lt; <span class="dv">0</span>) {</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* Nie ma już dzieci */</span></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (errno == ECHILD)</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span>;</span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* Wystąpił rzeczywisty błąd */</span></span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>        fprintf(stderr, <span class="st">&quot;error: wait: %s</span><span class="sc">\n</span><span class="st">&quot;</span>, strerror(errno));</span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span>;</span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</section>
<section id="wywołanie-waitpid" class="level2">
<h2>Wywołanie <code>waitpid()</code></h2>
<p>Wywołanie systemowe <code>waitpid()</code> pozwala zaczekać na konkretny process potomny</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> status;</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>waitpid(pid, &amp;status, <span class="dv">0</span>);</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (WIFEXITED(status))</span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>    printf(<span class="st">&quot;dziecko zwróciło: %d</span><span class="sc">\n</span><span class="st">&quot;</span>, WEXITSTATUS(status));</span></code></pre></div>
<p>Tak naprawde <code>wait()</code> działa tak samo jak:</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> pid = waitpid(-<span class="dv">1</span>, &amp;status, <span class="dv">0</span>);</span></code></pre></div>
<p>Więcej informacji</p>
<pre class="console"><code>$ man 2 wait</code></pre>
</section>
<section id="najistotniejsze-efekty-fork" class="level2">
<h2>Najistotniejsze efekty <code>fork()</code></h2>
<p>Podczas <strong>wywołania systemowego</strong> <code>fork()</code>:</p>
<ul class="incremental">
<li>Używany jest ten dalej ten sam <strong>kod programu</strong></li>
<li>Kopiowany jest <strong>stan procesora</strong> (w tym <strong>wskaźnik aktualnej instrukcji</strong>)</li>
<li>Dziedziczone są <strong>deskryptory plików</strong>:</li>
<li>Kopiowana są <strong>strony pamięci</strong>, ale dopiero po pierwszym zapisie (<strong>Copy-on-write</strong>)</li>
</ul>
</section>
<section id="tworzenie-procesu-który-będzie-wykonywał-inny-program" class="level2">
<h2>Tworzenie procesu, który będzie wykonywał inny program</h2>
<p>Wywołanie <code>fork()</code> powoduje utworzenie nowego procesu, który jest niemalże dokładną kopią procesu potomnego. Żeby zmienić kod wykonywanego programu należy użyc funkcji z rodziny <code>exec()</code></p>
<div class="sourceCode" id="cb139"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> execl(<span class="dt">const</span> <span class="dt">char</span> *path,</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>          <span class="dt">const</span> <span class="dt">char</span> *arg0, ..., <span class="co">/*, (char *)0, */</span>);</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> execle(<span class="dt">const</span> <span class="dt">char</span> *path,</span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>           <span class="dt">const</span> <span class="dt">char</span> *arg0, ..., <span class="co">/* (char *)0 char *const envp[] */</span>);</span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> execlp(<span class="dt">const</span> <span class="dt">char</span> *file,</span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>           <span class="dt">const</span> <span class="dt">char</span> *arg0, ..., <span class="co">/*, (char *)0, */</span>);</span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> execv(<span class="dt">const</span> <span class="dt">char</span> *path, <span class="dt">char</span> *<span class="dt">const</span> argv[]);</span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> execvp(<span class="dt">const</span> <span class="dt">char</span> *file, <span class="dt">char</span> *<span class="dt">const</span> argv[]);</span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> execvP(<span class="dt">const</span> <span class="dt">char</span> *file, <span class="dt">const</span> <span class="dt">char</span> *search_path,</span>
<span id="cb139-10"><a href="#cb139-10" aria-hidden="true" tabindex="-1"></a>          kchar *<span class="dt">const</span> argv[]);</span></code></pre></div>
<p>Wywołanie systemowe <code>exec()</code> ładuje nowy program do aktualnego procesu (czyli podmienia sekcje .data, .bss, .text, stos i sterte, biblioteki współdzielone)</p>
</section>
<section id="przykład-wykorzystania-exec" class="level2">
<h2>Przykład wykorzystania <code>exec()</code></h2>
<p>Przykładowy program, który utworzy proces potomny i załaduje do niego program <code>ls</code>. Proces rodzica będzie czekał na zakończenie procesu potomnego.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main(<span class="dt">int</span> argc, <span class="dt">char</span> **argv)</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> ret;</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>    ret = fork();</span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (ret == <span class="dv">0</span>) {</span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">char</span> *argv[] = { <span class="st">&quot;ls&quot;</span>, NULL };</span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>        ret = execvp(<span class="st">&quot;ls&quot;</span>, argv);</span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (ret) {</span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>            perror(<span class="st">&quot;execvp: &quot;</span>);</span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb140-12"><a href="#cb140-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb140-13"><a href="#cb140-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-14"><a href="#cb140-14" aria-hidden="true" tabindex="-1"></a>    wait(NULL);</span>
<span id="cb140-15"><a href="#cb140-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-16"><a href="#cb140-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb140-17"><a href="#cb140-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</section>
<section id="procesy-zombie" class="level2">
<h2>Procesy zombie</h2>
<p>Jeżeli proces zakończył swoje wykonywanie, a rodzic nie wykonał <code>wait()</code> to będzie on nadal widoczny na liście procesów, do momentu wykonania <code>wait()</code> przez rodzica.</p>
<p>Poniższy kod tworzy proces zombie, który będzie istniał około 30 sekund:</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main(<span class="dt">void</span>)</span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Klonujemy proces */</span></span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> pid = fork();</span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Jeżeli jesteśmy dzieckiem */</span></span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (pid == <span class="dv">0</span>)</span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span>; <span class="co">/* Kończymy - proces jest zombie do wykonania wait() */</span></span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Jeżeli jesteśmy rodzicem to czekamy 30 sekund*/</span></span>
<span id="cb141-11"><a href="#cb141-11" aria-hidden="true" tabindex="-1"></a>    sleep(<span class="dv">30</span>);</span>
<span id="cb141-12"><a href="#cb141-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Odczytujemy kod wyjścia procesu i usuwamy go z listy procesów */</span></span>
<span id="cb141-13"><a href="#cb141-13" aria-hidden="true" tabindex="-1"></a>    wait(NULL);</span>
<span id="cb141-14"><a href="#cb141-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb141-15"><a href="#cb141-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</section>
<section id="pytanie" class="level2">
<h2>Pytanie</h2>
<p>Jeżeli nie wywołamy <code>wait()</code>, to dlaczego dziecko znika po zakończeniu rodzica?</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main(<span class="dt">void</span>)</span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> pid = fork();</span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (pid == <span class="dv">0</span>)</span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-9"><a href="#cb142-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Nie wywołujemy tutaj wywołania systemowego wait(), więc nie zakończymy</span></span>
<span id="cb142-10"><a href="#cb142-10" aria-hidden="true" tabindex="-1"></a><span class="co">       dziecka */</span></span>
<span id="cb142-11"><a href="#cb142-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-12"><a href="#cb142-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb142-13"><a href="#cb142-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</section>
<section id="odpowiedź" class="level2">
<h2>Odpowiedź</h2>
<p>Każdy osierocony proces jest adoptowany przez główny proces (<code>systemd</code> albo <code>init</code>).</p>
<pre class="console"><code>$ pstree
systemd─┬─ModemManager─── ...
        ├─NetworkManager─── ...
        ├─fwupd───4*[{fwupd}]
        ├─gdm3─┬─gdm-session-wor─┬─gdm-x-session─┬─Xorg───{Xorg}
        │      │                 │               ├─gnome-session-b─┬─ssh-agent
        │      │                 │               │                 └─2*[{gnome-session-b}]
        │      │                 │               └─2*[{gdm-x-session}]
        │      │                 └─2*[{gdm-session-wor}]
        │      └─2*[{gdm3}]
        ├─ X
       ... ^
           |
           &#39;---- tu zostanie zaadoptowany osierocony proces</code></pre>
<p>Następnie <code>systemd</code> lub <code>init</code> wywoła na nim <code>wait()</code>.</p>
</section>
<section id="zagadka-0" class="level2">
<h2>Zagadka 0</h2>
<p>Ile procesów zostanie utworzonych w poniższym programie?</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main(<span class="dt">void</span>)</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>    fork();</span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>    fork();</span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a>    fork();</span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a>    fork();</span>
<span id="cb144-10"><a href="#cb144-10" aria-hidden="true" tabindex="-1"></a>    fork();</span>
<span id="cb144-11"><a href="#cb144-11" aria-hidden="true" tabindex="-1"></a>    fork();</span>
<span id="cb144-12"><a href="#cb144-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-13"><a href="#cb144-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb144-14"><a href="#cb144-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</section>
<section id="zagadka-1" class="level2">
<h2>Zagadka 1</h2>
<p>Ile procesów zostanie utworzonych w poniższym programie?</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main(<span class="dt">void</span>)</span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; <span class="dv">10</span>; ++i)</span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a>        fork();</span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-8"><a href="#cb145-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb145-9"><a href="#cb145-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</section>
<section id="zagadka-2" class="level2">
<h2>Zagadka 2</h2>
<p>Ile procesów zostanie utworzonych w poniższym programie?</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main(<span class="dt">void</span>)</span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; <span class="dv">10</span>; ++i) {</span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>        fork();</span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a>        execlp(<span class="st">&quot;ls&quot;</span>, <span class="st">&quot;ls&quot;</span>, NULL);</span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-10"><a href="#cb146-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb146-11"><a href="#cb146-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</section>
</section>
<section id="planista" class="level1">
<h1>Planista</h1>
<section id="planista-w-systemie-linux" class="level2">
<h2>Planista w systemie Linux</h2>
<p>Decydowaniem, który proces zostanie uruchomiony jako następny zajmuje się planista (ang. scheduler).</p>
<p>Zadaniem planisty jest dbanie o podział czasu procesora według ustalonych celów.</p>
<p>Planista w systemie Linux to <strong>Całkowicie Sprawiedliwy Planista</strong> (ang. Completely Fair Scheduler, CFS)</p>
<p>Dba on o to aby każdy proces otrzymał sprawiedliwą część czasu procesora.</p>
<p>Za każdym razem uruchamia ten process który otrzymał do tej pory najmniej czasu, w stosunku do należnej części.</p>
</section>
<section id="jak-planista-reprezentuje-procesy" class="level2">
<h2>Jak planista reprezentuje procesy</h2>
<p>W systemie Linux każdy proces, jest reprezentowany przez strukturę <code>struct task_struct</code></p>
<p>Oto jej ważniejsze pola:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> task_struct {</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> list_head tasks           <span class="co">/* Wpis na liscie procesów */</span></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>    pid_t pid;                       <span class="co">/* Identyfikator procesu */</span></span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> mm_struct *mm             <span class="co">/* Przestrzeń adresowa */</span></span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> task_struct *real_parent; <span class="co">/* Prawdziwy rodzic - ten kto wywołał clone() */</span></span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> task_struct *parent;      <span class="co">/* Odbiorca SIGCHLD i wait4() */</span></span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> list_head children;       <span class="co">/* Dzieci procesu */</span></span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> sigpending pending;       <span class="co">/* Lista oczekujących sygnałów */</span></span>
<span id="cb147-9"><a href="#cb147-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> files_struct *files;      <span class="co">/* Otwarte deskryptory plików */</span></span>
<span id="cb147-10"><a href="#cb147-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> *stack                      <span class="co">/* Wskaznik do stosu jądra dla tego</span></span>
<span id="cb147-11"><a href="#cb147-11" aria-hidden="true" tabindex="-1"></a><span class="co">                                        procesu - tu są zapisane rejestry */</span></span>
<span id="cb147-12"><a href="#cb147-12" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb147-13"><a href="#cb147-13" aria-hidden="true" tabindex="-1"></a>};</span></code></pre></div>
</section>
<section id="lista-procesów" class="level2">
<h2>Lista procesów</h2>
<p>System operacyjny przechowuje procesy na liście dwukierunkowej.</p>
<p><img src="assets/12.svg" /></p>
</section>
<section id="jak-cfs-przydziela-czas-procesora" class="level2">
<h2>Jak CFS przydziela czas procesora</h2>
<p>Długości odcinków czasowych są wyliczane dynamicznie, na podstawie docelowego opóźnienia (ang. target latency) i priorytetu procesu (niceness i priority), dzięki czemu podział czasu procesora jest zawsze sprawiedliwy.</p>
<p><img src="assets/10.svg" /></p>
</section>
<section id="preemptive-vs-cooperative-multitasking" class="level2">
<h2>Preemptive vs Cooperative multitasking</h2>
<p>W przypadku preemptive multitasking planista może wywłaszczyć proces w dowolnym momencie, w przypadku cooperative - tylko w wyznaczonym przez proces momencie. <strong>Planista w Linuksie implementuje preemptive multitasking.</strong></p>
<p><img src="assets/11.svg" /></p>
</section>
<section id="kiedy-następuje-wywłaszczenie" class="level2">
<h2>Kiedy następuje wywłaszczenie</h2>
<p>CFS może zaplanować wykonywanie innego procesu w momencie wystąpienia przerwania:</p>
<p>Czyli na przykład w momencie:</p>
<ul class="incremental">
<li>naciśnięcia klawisza, odebrania pakietu sieciowego czy innego zdarzenia sprzętowego;</li>
<li>przerwania pochodzącego od czasomierza systemowego (Programmable System Timer);</li>
<li>wywołania systemowego (np. <code>open()</code>, <code>fork()</code>, <code>sleep()</code>, <code>write()</code>).</li>
</ul>
<div class="sourceCode" id="cb148"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main(<span class="dt">void</span>)</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x, w;</span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>    x = <span class="dv">1</span>;                               &lt;---- tu może wystąpić przerwanie, możliwa zmiana procesu</span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>    printf(<span class="st">&quot;%d</span><span class="sc">\n</span><span class="st">&quot;</span>, x);                   &lt;---- wywołanie systemowe write(), możliwa zmiana procesu</span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> fd = open(<span class="st">&quot;plik.txt&quot;</span>, O_RDONLY); &lt;---- wywołanie systemowe open(), możliwa zmiana procesu</span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a>    w = x + <span class="dv">1</span>;                           &lt;---- tu może wystąpić przerwanie, możliwa zmiana procesu</span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> *g = malloc(<span class="kw">sizeof</span>(*g));         &lt;---- malloc() nie jest wywołaniem systemowym ale</span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a>                                               może wywołać brk(), sbrk(), mmap(), które są,</span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a>                                               czyli możliwa zmiana procesu</span>
<span id="cb148-11"><a href="#cb148-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</section>
</section>
<section id="wywołania-systemowe" class="level1">
<h1>Wywołania systemowe</h1>
<section id="co-jest-efektem-kompilacji" class="level2">
<h2>Co jest efektem kompilacji?</h2>
<p>Kod w języku C jest kompilowany do instrukcji maszynowych</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> foo(<span class="dt">int</span> a, <span class="dt">int</span> b)  _foo: </span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>{                      pushq %rbp            <span class="co">// Zapisz podstawe stosu</span></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> c = a + b;     movq  %rsp, %rbp      <span class="co">// Weź szczyt stosu jako podstawę</span></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> c;          movl  %edi, %eax      <span class="co">// Wrzuć pierwszy argument do %eax</span></span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>}                      addl  %esi, %eax      <span class="co">// Dodaj drugi argument do %eax</span></span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>                       movl  %eax, -<span class="dv">4</span>(%rbp)  <span class="co">// Wynik wrzuć na stos</span></span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a>                       movl  -<span class="dv">4</span>(%rbp), %eax  <span class="co">// Przekaż wartość zwracaną przez %eax</span></span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a>                       popq  %rbp            <span class="co">// Załaduj zapisaną podstawę stosu podstawę stosu</span></span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a>                       retq                  <span class="co">// Wróć z powrotem w miejsce wywołania  </span></span></code></pre></div>
</section>
<section id="instrukcje-uprzywilejowane" class="level2">
<h2>Instrukcje uprzywilejowane</h2>
<p>Nie wszystkie instrukcje procesora są dostępne dla procesów użytkownika. Procesy użytkownika nie mogą między innymi odczytywać pamięci chronionej, ani wykonywać niektórych instrukcji. Na przykład:</p>
<ul class="incremental">
<li><code>LGDT</code> - nadpisywanie tablicy przerwań;</li>
<li><code>IN</code>, <code>OUT</code> - obługa urządzeń wejścia/wyjścia;</li>
<li><code>MOV %eax, %cr3</code> - modyfikacja tablicy stron.</li>
</ul>
<p>Procesy mogą jedynie “prosić” system operacyjny, żeby on w ich imieniu wykonywał te instrukcje. Tą prośbą są <strong>wywołania systemowe</strong>.</p>
</section>
<section id="wywołania-systemowe-1" class="level2">
<h2>Wywołania systemowe</h2>
<p>Wywołania systemowe, są przerwaniem programowym (ang. software interrupt)</p>
<ol class="incremental" type="1">
<li>Program wykonuje przerwanie (<code>syscall</code> lub <code>int 0x80</code>), w rejestrach ustawia odpowieni numer przerwania oraz przekazuje odpowiednie argumenty</li>
<li>System operacyjny zaczyna wykonywać procedurę obsługi tego przerwania: zapisuje stan procesora, przełącza stos programu na stos jądra (zmienia rejestr <code>%esp</code> - wskaźnik stosu), i wykonuje odpowiednią operację wskazaną numerem wywołania systemowego.</li>
<li>Po wykonaniu wywołania systemowego system operacyjny przywraca stan procesora (w tym stos procesu) i wznawiane jest wykonywanie programu.</li>
</ol>
<div class="sourceCode" id="cb150"><pre class="sourceCode asm"><code class="sourceCode fasm"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">message:</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>    .asciz <span class="st">&quot;Hello world\n&quot;</span></span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>.<span class="bu">set</span> message_size<span class="op">,</span> <span class="op">.</span> <span class="op">-</span> message</span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>movl <span class="op">$</span><span class="bn">1</span><span class="op">,</span> <span class="op">%</span><span class="kw">edi</span></span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a>leaq message<span class="op">(%</span>rip<span class="op">),</span> <span class="op">%</span><span class="kw">rsi</span></span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a><span class="bu">movq</span> <span class="op">$</span>message_size<span class="op">,</span> <span class="op">%</span><span class="kw">rdx</span></span>
<span id="cb150-8"><a href="#cb150-8" aria-hidden="true" tabindex="-1"></a><span class="bu">movq</span> <span class="op">$</span><span class="bn">1</span><span class="op">,</span> <span class="op">%</span><span class="kw">rax</span>             <span class="co">;1 is sys_write syscall number</span></span>
<span id="cb150-9"><a href="#cb150-9" aria-hidden="true" tabindex="-1"></a><span class="cf">syscall</span></span></code></pre></div>
</section>
<section id="wywołania-systemowe-a-funkcje" class="level2">
<h2>Wywołania systemowe a funkcje</h2>
<p>Biblioteka standardowa języka C (np. <code>glibc</code>, <code>musl</code> lub <code>uClibc</code>), implementuje funkcje, które uruchamiają wywołania systemowe o podobnych nazwach. Oprócz tego implementuje jeszcze dodatkową funkcjonalność oraz funkcje, które nie są wywołaniami systemowymi.</p>
<p>Przykłady:</p>
<table>
<thead>
<tr class="header">
<th>funkcja</th>
<th>typ</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>open()</code></td>
<td><code>syscall(SYS_open, ...)</code></td>
</tr>
<tr class="even">
<td><code>fork()</code></td>
<td><code>syscall(SYS_fork, ...)</code></td>
</tr>
<tr class="odd">
<td><code>write()</code></td>
<td><code>syscall(SYS_write, ...)</code></td>
</tr>
<tr class="even">
<td><code>read()</code></td>
<td><code>syscall(SYS_read, ...)</code></td>
</tr>
<tr class="odd">
<td><code>printf()</code></td>
<td><code>syscall(SYS_write)</code> + dodatkowa funkcjonalność</td>
</tr>
<tr class="even">
<td><code>malloc()</code></td>
<td><code>syscall(SYS_brk)</code> + dodatkowa funkcjonalność</td>
</tr>
<tr class="odd">
<td><code>fopen()</code></td>
<td><code>syscall(SYS_open)</code> + dodatkowa funkcjonalność</td>
</tr>
<tr class="even">
<td><code>strlen()</code></td>
<td>funkcja biblioteczna</td>
</tr>
<tr class="odd">
<td><code>memcpy()</code></td>
<td>funkcja biblioteczna</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="pamięć-procesu" class="level1">
<h1>Pamięć procesu</h1>
<section id="zmienne-reprezentują-komórki-pamięci" class="level2">
<h2>Zmienne reprezentują komórki pamięci</h2>
<p>Każda zmienna reprezentuje pewną komórkę pamięci.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> y = <span class="dv">2</span>; <span class="co">/* Zmienna w sekcji .data */</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main(<span class="dt">void</span>)</span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x; <span class="co">/* Zmienna na stosie */</span></span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a>    printf(<span class="st">&quot;%p</span><span class="sc">\n</span><span class="st">&quot;</span>, &amp;x);</span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a>    printf(<span class="st">&quot;%p</span><span class="sc">\n</span><span class="st">&quot;</span>, &amp;y);</span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-10"><a href="#cb151-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb151-11"><a href="#cb151-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</section>
<section id="pamięć-wirtualna" class="level2">
<h2>Pamięć wirtualna</h2>
<p>Proces operuje na wirtualnych adresach pamięci, które są mapowane do fizycznych adresów, przez tabele stron. Instruuje ona jednostkę zarządzania pamięcią (ang. Memory Management Unit) w jaki sposób ma mapować pamięć.</p>
<p><img src="assets/1.svg" /></p>
</section>
<section id="sekcje-pamięci" class="level2">
<h2>Sekcje pamięci</h2>
<p>W systemie Linux skompilowany program będzie miał odpowiednią strukturę w pamięci:</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x;  <span class="co">/* Niezainicjalizowane dane (.bss) */</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> y = <span class="dv">3</span>; <span class="co">/* Zainicjalizowane dane (.data) */</span></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> foo(<span class="dt">int</span> x) <span class="co">/* Argumenty w rejestrach lub na stosie */</span>     ---.</span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>{                                                                 |</span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">static</span> <span class="dt">int</span> x; <span class="co">/* Niezainicjalizowane dane (.bss) */</span>           |</span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">static</span> <span class="dt">int</span> y = <span class="dv">4</span>; <span class="co">/* Zainicjalizowane dane (.data) */</span>         |</span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a>}                                                                 |</span>
<span id="cb152-8"><a href="#cb152-8" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main(<span class="dt">void</span>)                                                    |    kod</span>
<span id="cb152-9"><a href="#cb152-9" aria-hidden="true" tabindex="-1"></a>{                                                                 |___ programu</span>
<span id="cb152-10"><a href="#cb152-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x; <span class="co">/* Alokacja na stosie */</span>                               |    umieszczany</span>
<span id="cb152-11"><a href="#cb152-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> *y = malloc(<span class="dv">1024</span>); <span class="co">/* Wskaźnik na stosie, */</span>              |    w sekcji .text</span>
<span id="cb152-12"><a href="#cb152-12" aria-hidden="true" tabindex="-1"></a>                           <span class="co">/* a blok pamięci na stercie */</span>        |</span>
<span id="cb152-13"><a href="#cb152-13" aria-hidden="true" tabindex="-1"></a>    foo(<span class="dv">1</span>); <span class="co">/* Adres powrotu na stosie,                           |</span></span>
<span id="cb152-14"><a href="#cb152-14" aria-hidden="true" tabindex="-1"></a><span class="co">               argumenty w rejestrach lub na stosie  */</span>           |</span>
<span id="cb152-15"><a href="#cb152-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span>;                                                     |</span>
<span id="cb152-16"><a href="#cb152-16" aria-hidden="true" tabindex="-1"></a>}                                                              ---&#39;</span></code></pre></div>
</section>
<section id="sekcje-pamięci-procesu" class="level2">
<h2>Sekcje pamięci procesu</h2>
<p>Pamięć procesu podzielona jest na sekcje, w których znajdują się “podobnego” rodzaju dane.</p>
<p><img src="assets/2.svg" /></p>
</section>
<section id="przykład-sekcji-pamięci---proces-yes" class="level2">
<h2>Przykład sekcji pamięci - proces <code>yes</code></h2>
<pre class="console"><code>$ cat /proc/39299/maps
56148e969000-56148e96b000 r--p 00000000 08:05 24118661   /usr/bin/yes
56148e96b000-56148e96f000 r-xp 00002000 08:05 24118661   /usr/bin/yes
56148e96f000-56148e971000 r--p 00006000 08:05 24118661   /usr/bin/yes
56148e972000-56148e973000 r--p 00008000 08:05 24118661   /usr/bin/yes
56148e973000-56148e974000 rw-p 00009000 08:05 24118661   /usr/bin/yes
56148f694000-56148f6b5000 rw-p 00000000 00:00 0          [heap]
7f9f89876000-7f9f8a8cc000 r--p 00000000 08:05 24117276   /usr/lib/locale/locale-archive
7f9f8a8cc000-7f9f8a8ee000 r--p 00000000 08:05 24122481   /usr/lib/x86_64-linux-gnu/libc-2.31.so
7f9f8a8ee000-7f9f8aa66000 r-xp 00022000 08:05 24122481   /usr/lib/x86_64-linux-gnu/libc-2.31.so
7f9f8aa66000-7f9f8aab4000 r--p 0019a000 08:05 24122481   /usr/lib/x86_64-linux-gnu/libc-2.31.so
7f9f8aab4000-7f9f8aab8000 r--p 001e7000 08:05 24122481   /usr/lib/x86_64-linux-gnu/libc-2.31.so
7f9f8aab8000-7f9f8aaba000 rw-p 001eb000 08:05 24122481   /usr/lib/x86_64-linux-gnu/libc-2.31.so
7f9f8aaba000-7f9f8aac0000 rw-p 00000000 00:00 0
7f9f8aae0000-7f9f8aae1000 r--p 00000000 08:05 24122477   /usr/lib/x86_64-linux-gnu/ld-2.31.so
7f9f8aae1000-7f9f8ab04000 r-xp 00001000 08:05 24122477   /usr/lib/x86_64-linux-gnu/ld-2.31.so
7f9f8ab04000-7f9f8ab0c000 r--p 00024000 08:05 24122477   /usr/lib/x86_64-linux-gnu/ld-2.31.so
7f9f8ab0d000-7f9f8ab0e000 r--p 0002c000 08:05 24122477   /usr/lib/x86_64-linux-gnu/ld-2.31.so
7f9f8ab0e000-7f9f8ab0f000 rw-p 0002d000 08:05 24122477   /usr/lib/x86_64-linux-gnu/ld-2.31.so
7f9f8ab0f000-7f9f8ab10000 rw-p 00000000 00:00 0
7ffe6a478000-7ffe6a499000 rw-p 00000000 00:00 0          [stack]
7ffe6a5cb000-7ffe6a5cf000 r--p 00000000 00:00 0          [vvar]
7ffe6a5cf000-7ffe6a5d1000 r-xp 00000000 00:00 0          [vdso]
ffffffffff600000-ffffffffff601000 --xp 00000000 00:00 0  [vsyscall]</code></pre>
</section>
<section id="address-space-layout-randomization" class="level2">
<h2>Address space layout randomization</h2>
<p>Adresy sekcji są losowe, aby utrudnić manipulacje na pamięci atakującemu.</p>
<p><img src="assets/3.svg" /></p>
</section>
<section id="kaslr" class="level2">
<h2>KASLR</h2>
<p>Jądro jest mapowane pod losowym adresem</p>
<p><img src="assets/4.svg" /></p>
</section>
<section id="kaiser" class="level2">
<h2>KAISER</h2>
<p>Mapowana jest tylko niezbędna część jądra. Po przełączeniu się w tryb jądra (przy wywołaniach systemowych) tabela stron jest przełączana na pełną wersję (zmiana rejestru CR3).</p>
<p><img src="assets/5.svg" /></p>
</section>
<section id="copy-on-write" class="level2">
<h2>Copy-on-write</h2>
<p>Strony pamięci wirtualnej nowego procesu oznaczone są jako tylko do odczytu. Próba nadpisania skutkuje wyjątkiem Page Fault, którego obsługa pozwala systemowi operacyjnemu skopiować stronę</p>
<p><img src="assets/0.svg" /></p>
</section>
</section>
<section id="dziękuję-za-uwagę" class="level1">
<h1>Dziękuję za uwagę</h1>
<section id="dalsza-lektura" class="level2">
<h2>Dalsza lektura</h2>
<ul class="incremental">
<li><strong>Książki</strong>
<ul class="incremental">
<li>Love Robert. 2010. Linux Kernel Development. Pearson Education.</li>
<li>Love Robert. 2013. Linux System Programming. O’REILLY.</li>
<li>Stevens Richard W., Rago Stephen A., Advanced Programming in the UNIX® Environment, Third Edition. Addison-Wesley.</li>
</ul></li>
<li><strong>Artykuły</strong>
<ul class="incremental">
<li>https://lwn.net/Articles/738975/</li>
<li>https://samwho.dev/blog/context-switching-on-x86/</li>
</ul></li>
<li><strong>Manual</strong>
<ul class="incremental">
<li><code>man 2 fork</code></li>
<li><code>man 2 wait</code></li>
<li><code>man 3 exec</code></li>
</ul></li>
</ul>
</section>
</section>
<script>
/*!	
* FitText.js 1.0 jQuery free version
*
* Copyright 2011, Dave Rupert http://daverupert.com 
* Released under the WTFPL license 
* http://sam.zoy.org/wtfpl/
* Modified by Slawomir Kolodziej http://slawekk.info
*
* Date: Tue Aug 09 2011 10:45:54 GMT+0200 (CEST)
*/
(function(){

  var addEvent = function (el, type, fn) {
    if (el.addEventListener)
      el.addEventListener(type, fn, false);
		else
			el.attachEvent('on'+type, fn);
  };
  
  var extend = function(obj,ext){
    for(var key in ext)
      if(ext.hasOwnProperty(key))
        obj[key] = ext[key];
    return obj;
  };

  window.fitText = function (el, kompressor, options) {

    var settings = extend({
      'minFontSize' : -1/0,
      'maxFontSize' : 1/0
    },options);

    var fit = function (el) {
      var compressor = kompressor || 1;

      var resizer = function () {
        el.style.fontSize = Math.max(Math.min(el.clientWidth / (compressor*10), parseFloat(settings.maxFontSize)), parseFloat(settings.minFontSize)) + 'px';
      };

      // Call once to set.
      resizer();

      // Bind events
      // If you have any js library which support Events, replace this part
      // and remove addEvent function (or use original jQuery version)
      addEvent(window, 'resize', resizer);
      addEvent(window, 'orientationchange', resizer);
    };

    if (el.length)
      for(var i=0; i<el.length; i++)
        fit(el[i]);
    else
      fit(el);

    // return set of elements
    return el;
  };
})();

    fitText(document.querySelectorAll('.level2'), 5);
    fitText(document.querySelectorAll('h1'), 2.5);

    document.querySelectorAll('p > img').forEach(e => e.parentNode.style.overflow="hidden");

</script>
  </body>
</html>
